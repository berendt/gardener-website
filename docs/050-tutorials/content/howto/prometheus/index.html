
	<!DOCTYPE html>
<html lang="en" class="js csstransforms3d">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

    <meta name="description" content="How to deploy and configure Prometheus and Grafana to collect and monitor kubelet container metrics">
<meta name="author" content="Andreas Herz">

    <link rel="shortcut icon" href="/images/favicon.png" type="image/x-icon" />
<link rel="icon" href="/images/favicon.png" type="image/x-icon" />
    <title>Using Prometheus and Grafana to monitor K8s :: Gardener Documentation</title>

    <link rel="icon" type="image/x-icon" href='https://gardener.cloud/images/favicon.ico'>
    <link rel="icon" type="image/png"    href='https://gardener.cloud/images/favicon-32x32.png' sizes="32x32">
    <link rel="icon" type="image/png"    href='https://gardener.cloud/images/favicon-16x16.png' sizes="16x16">

    
    <link href="/css/nucleus.css?1578319962" rel="stylesheet">
    <link href="/css/fontawesome-all.min.css?1578319962" rel="stylesheet">
    <link href="/css/hybrid.css?1578319962" rel="stylesheet">
    <link href="/css/featherlight.min.css?1578319962" rel="stylesheet">
    <link href="/css/perfect-scrollbar.min.css?1578319962" rel="stylesheet">
    <link href="/css/auto-complete.css?1578319962" rel="stylesheet">

    <link href="/css/skeleton.css?1578319962" rel="stylesheet">
    <link href="/css/sheetslider.css?1578319962" rel="stylesheet">

      <script src="/js/moment.js?1578319962"></script>
      <script src="/js/vivus.js?1578319962"></script>
      <script src="/js/scrollreveal.js?1578319962"></script>
      <script src="/js/inlineSVG.js?1578319962"></script>

    <link href="/css/theme.css?1578319962" rel="stylesheet">
    <link href="/css/hugo-theme.css?1578319962" rel="stylesheet">
    
      <link href="/css/theme-gardener.css?1578319962" rel="stylesheet">
    

    <script src="/js/jquery-2.x.min.js?1578319962"></script>
    
    <style type="text/css">
      :root #header + #content > #left > #rlblock_left{ 
          display:none !important;
      }

    </style>

    

  </head>


  <body class="" data-url="/050-tutorials/content/howto/prometheus/">
    <nav id="sidebar" class="">

  <div id="header-wrapper">
    <div id="header">
      <a id="logo" href="https://gardener.cloud/">

	<svg width="90px" height="90px" viewBox="0 0 90 90" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
		
		<title>logo</title>
		<defs>
			<path d="M41.8864954,0.994901575 C42.8830405,0.514990742 44.5028956,0.516982644 45.4953045,0.994901575 L76.8159138,16.0781121 C77.8124589,16.5580229 78.8208647,17.8257185 79.0659694,18.8995926 L86.8015211,52.7912589 C87.0476474,53.8696088 86.6852538,55.4484075 85.9984855,56.3095876 L64.3239514,83.4885938 C63.6343208,84.3533632 62.1740175,85.0543973 61.0725268,85.0543973 L26.3092731,85.0543973 C25.2031915,85.0543973 23.7446167,84.3497739 23.0578485,83.4885938 L1.38331434,56.3095876 C0.693683723,55.4448182 0.335174016,53.865133 0.580278769,52.7912589 L8.31583044,18.8995926 C8.56195675,17.8212428 9.57347722,16.556031 10.5658861,16.0781121 L41.8864954,0.994901575 Z" id="path-1"></path>
			<linearGradient x1="12.7542673%" y1="-18.6617048%" x2="88.2666158%" y2="84.6075483%" id="linearGradient-3">
				<stop stop-color="#FFFFFF" offset="0%"></stop>
				<stop stop-color="#439246" offset="100%"></stop>
			</linearGradient>
			<linearGradient x1="50%" y1="4.93673768%" x2="148.756007%" y2="175.514523%" id="linearGradient-4">
				<stop stop-color="#FFFFFF" offset="0%"></stop>
				<stop stop-color="#439246" offset="100%"></stop>
			</linearGradient>
			<linearGradient x1="19.1574381%" y1="-9.04800713%" x2="82.2203149%" y2="77.9084293%" id="linearGradient-5">
				<stop stop-color="#FFFFFF" offset="0%"></stop>
				<stop stop-color="#439246" offset="100%"></stop>
			</linearGradient>
			<linearGradient x1="57.4403751%" y1="26.3148481%" x2="137.966711%" y2="158.080556%" id="linearGradient-6">
				<stop stop-color="#FFFFFF" offset="0%"></stop>
				<stop stop-color="#439246" offset="100%"></stop>
			</linearGradient>
		</defs>
		<g id="logo" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
			<g id="Rectangle-2" transform="translate(1.000000, 0.000000)">
				<mask id="mask-2" fill="white">
					<use xlink:href="#path-1"></use>
				</mask>
				<use id="Mask" fill="#009F76" xlink:href="#path-1"></use>
				<polygon fill="#000000" opacity="0.289628623" mask="url(#mask-2)" points="-17.6484375 54.5224609 30.8242188 25.0791016 63.4726562 58.5 24.7324219 92.6689453"></polygon>
			</g>
			<path d="M56.8508631,39.260019 C56.4193519,40.443987 55.6088085,41.581593 54.6736295,42.1938694 L46.5997298,47.4799783 C45.2142627,48.3870654 42.9749783,48.3916494 41.5825097,47.4799783 L33.50861,42.1938694 C32.123143,41.2867823 31,39.206345 31,37.545932 L31,26.4150304 C31,25.6897174 31.2131118,24.884885 31.5692681,24.1324532 L56.8508631,39.260019 Z" id="Combined-Shape" fill="url(#linearGradient-3)" transform="translate(43.925432, 36.147233) scale(-1, 1) translate(-43.925432, -36.147233) "></path>
			<path d="M56.0774672,25.1412464 C56.4306829,25.8903325 56.6425556,26.6907345 56.6425556,27.4119019 L56.6425556,38.5428034 C56.6425556,40.2027013 55.5264141,42.2790698 54.1339456,43.1907408 L46.0600459,48.4768498 C44.6745788,49.3839368 42.4352943,49.3885208 41.0428258,48.4768498 L32.9689261,43.1907408 C32.2918101,42.7474223 31.6773514,42.0238435 31.2260376,41.206007 L56.0774672,25.1412464 Z" id="Combined-Shape" fill="url(#linearGradient-4)" transform="translate(43.821278, 37.246598) scale(-1, 1) translate(-43.821278, -37.246598) "></path>
			<path d="M65.0702134,57.1846889 C64.5985426,58.2007851 63.8367404,59.1236871 62.9788591,59.6189851 L47.37497,68.6278947 C45.9443535,69.4538615 43.6226022,69.4525546 42.1942494,68.6278947 L26.5903603,59.6189851 C25.1597438,58.7930183 24,56.7816693 24,55.1323495 L24,37.1145303 C24,36.3487436 24.249712,35.5060005 24.6599102,34.7400631 L65.0702134,57.1846889 Z" id="Combined-Shape" fill="url(#linearGradient-5)"></path>
			<path d="M65.0189476,34.954538 C65.3636909,35.6617313 65.5692194,36.42021 65.5692194,37.1145303 L65.5692194,55.1323495 C65.5692194,56.7842831 64.4072119,58.7943252 62.9788591,59.6189851 L47.37497,68.6278947 C45.9443535,69.4538615 43.6226022,69.4525546 42.1942494,68.6278947 L26.5903603,59.6189851 C25.9237304,59.2341061 25.3159155,58.5918431 24.8568495,57.8487596 L65.0189476,34.954538 Z" id="Combined-Shape" fill="url(#linearGradient-6)"></path>
		</g>
	</svg>
	<h1>Gardener</h1>
	<h2>Universal Kubernetes at Scale</h2>
</a>

    </div>
    <div class="searchbox">
    <label for="search-by"><i class="fas fa-search"></i></label>
    <input data-search-input id="search-by" type="text" placeholder="Search...">
    <span data-search-clear=""><i class="fas fa-close"></i></span>
</div>

<script type="text/javascript" src="/js/lunr.min.js?1578319962"></script>
<script type="text/javascript" src="/js/auto-complete.js?1578319962"></script>
<script type="text/javascript">
    
        var baseurl = '\/';
    
</script>
<script type="text/javascript" src="/js/search.js?1578319962"></script>

  </div>


  <div class="highlightable">
      <ul class="topics">
            
                 
                 




  
    
    <li data-nav-id="/about/" title="Getting Started" class="dd-item
        
        
        
        ">
        
          <a href="/about/">
              
              <img class="navigation-icon" src="https://gardener.cloud/images/navigation_started.svg"/>
              
              Getting Started
          </a>
          
          
      
    </li>
  


            
                 
                 




  
    
    <li data-nav-id="/030-architecture/" title="Architecture" class="dd-item
        
        
        
        ">
        
          <a href="/030-architecture/">
              
              <img class="navigation-icon" src="https://gardener.cloud/images/navigation_architecture.svg"/>
              
              Architecture
          </a>
          
          
            <ul>
              
              
                
              
              


              
                
                    




  
    
    <li data-nav-id="/components/gardner/" title="Gardener" class="dd-item
        
        
        
        ">
        
          <a href="/components/gardner/">
              
              Gardener
          </a>
          
          
      
    </li>
  


                
              
                
                    




  
    
    <li data-nav-id="/components/gardenctl/" title="gardenctl" class="dd-item
        
        
        
        ">
        
          <a href="/components/gardenctl/">
              
              gardenctl
          </a>
          
          
      
    </li>
  


                
              
                
                    




  
    
    <li data-nav-id="/components/mcm/" title="Machine Controller Manager" class="dd-item
        
        
        
        ">
        
          <a href="/components/mcm/">
              
              Machine Controller Manager
          </a>
          
          
      
    </li>
  


                
              
                
                    




  
    
    <li data-nav-id="/components/cert--broker/" title="Cert Broker" class="dd-item
        
        
        
        ">
        
          <a href="/components/cert--broker/">
              
              Cert Broker
          </a>
          
          
      
    </li>
  


                
              
                
                    




  
    
    <li data-nav-id="/components/dns-cm/" title="DNS Controller Manager" class="dd-item
        
        
        
        ">
        
          <a href="/components/dns-cm/">
              
              DNS Controller Manager
          </a>
          
          
      
    </li>
  


                
              
                
                    




  
    
    <li data-nav-id="/components/dashboard/" title="Dashboard" class="dd-item
        
        
        
        ">
        
          <a href="/components/dashboard/">
              
              Dashboard
          </a>
          
          
      
    </li>
  


                
              
                
                    




  
    
    <li data-nav-id="/components/kubify/" title="kubify" class="dd-item
        
        
        
        ">
        
          <a href="/components/kubify/">
              
              kubify
          </a>
          
          
      
    </li>
  


                
              
                
                    




  
    
    <li data-nav-id="/components/bouquet/" title="Bouquet" class="dd-item
        
        
        
        ">
        
          <a href="/components/bouquet/">
              
              Bouquet
          </a>
          
          
      
    </li>
  


                
              

            </ul>
        
      
    </li>
  


            
                 
                 




  
    
    <li data-nav-id="/contribute/" title="Contribute" class="dd-item
        
        
        
        ">
        
          <a href="/contribute/">
              
              <img class="navigation-icon" src="https://gardener.cloud/images/navigation_contribute.svg"/>
              
              Contribute
          </a>
          
          
            <ul>
              
              
                
              
              


              
                
                    




  
    
    <li data-nav-id="/contribute/code/" title="Code" class="dd-item
        
        
        
        ">
        
          <a href="/contribute/code/">
              
              Code
          </a>
          
          
            <ul>
              
              
                
              
              


              
                
                    




  
    
    <li data-nav-id="/045_contribute/10_code/10-contribution_guide/" title="Contribution Guide" class="dd-item
        
        
        
        ">
        
          <a href="/045_contribute/10_code/10-contribution_guide/">
              
              Contribution Guide
          </a>
          
          
      
    </li>
  


                
              
                
                    




  
    
    <li data-nav-id="/045_contribute/10_code/12-security_guide/" title="Security Release Process" class="dd-item
        
        
        
        ">
        
          <a href="/045_contribute/10_code/12-security_guide/">
              
              Security Release Process
          </a>
          
          
      
    </li>
  


                
              
                
                    




  
    
    <li data-nav-id="/045_contribute/10_code/13_env/" title="Enviroment" class="dd-item
        
        
        
        ">
        
          <a href="/045_contribute/10_code/13_env/">
              
              Enviroment
          </a>
          
          
      
    </li>
  


                
              
                
                    




  
    
    <li data-nav-id="/045_contribute/10_code/14_cicd/" title="CI/CD" class="dd-item
        
        
        
        ">
        
          <a href="/045_contribute/10_code/14_cicd/">
              
              CI/CD
          </a>
          
          
      
    </li>
  


                
              
                
                    




  
    
    <li data-nav-id="/045_contribute/10_code/15_conf_secrets/" title="Configuration and Usage" class="dd-item
        
        
        
        ">
        
          <a href="/045_contribute/10_code/15_conf_secrets/">
              
              Configuration and Usage
          </a>
          
          
      
    </li>
  


                
              
                
                    




  
    
    <li data-nav-id="/045_contribute/10_code/20_dependencies/" title="Dependencies" class="dd-item
        
        
        
        ">
        
          <a href="/045_contribute/10_code/20_dependencies/">
              
              Dependencies
          </a>
          
          
      
    </li>
  


                
              
                
                    




  
    
    <li data-nav-id="/045_contribute/10_code/27_deploy_into_cluster/" title="Deploy into a Cluster" class="dd-item
        
        
        
        ">
        
          <a href="/045_contribute/10_code/27_deploy_into_cluster/">
              
              Deploy into a Cluster
          </a>
          
          
      
    </li>
  


                
              
                
                    




  
    
    <li data-nav-id="/045_contribute/10_code/30_deploy_seed_into_aks/" title="Deploy into AKS" class="dd-item
        
        
        
        ">
        
          <a href="/045_contribute/10_code/30_deploy_seed_into_aks/">
              
              Deploy into AKS
          </a>
          
          
      
    </li>
  


                
              
                
                    




  
    
    <li data-nav-id="/045_contribute/10_code/37_process/" title="Process" class="dd-item
        
        
        
        ">
        
          <a href="/045_contribute/10_code/37_process/">
              
              Process
          </a>
          
          
      
    </li>
  


                
              
                
                    




  
    
    <li data-nav-id="/045_contribute/10_code/40_repositories/" title="Repositories" class="dd-item
        
        
        
        ">
        
          <a href="/045_contribute/10_code/40_repositories/">
              
              Repositories
          </a>
          
          
      
    </li>
  


                
              

            </ul>
        
      
    </li>
  


                
              
                
                    




  
    
    <li data-nav-id="/contribute/docs/" title="Documentation" class="dd-item
        
        
        
        ">
        
          <a href="/contribute/docs/">
              
              Documentation
          </a>
          
          
            <ul>
              
              
                
              
              


              
                
                    




  
    
    <li data-nav-id="/045_contribute/20_documentation/10_organisation/" title="Organisation" class="dd-item
        
        
        
        ">
        
          <a href="/045_contribute/20_documentation/10_organisation/">
              
              Organisation
          </a>
          
          
      
    </li>
  


                
              
                
                    




  
    
    <li data-nav-id="/045_contribute/20_documentation/20_style/" title="Style Guide" class="dd-item
        
        
        
        ">
        
          <a href="/045_contribute/20_documentation/20_style/">
              
              Style Guide
          </a>
          
          
      
    </li>
  


                
              
                
                    




  
    
    <li data-nav-id="/045_contribute/20_documentation/25_markup/" title="Markdown" class="dd-item
        
        
        
        ">
        
          <a href="/045_contribute/20_documentation/25_markup/">
              
              Markdown
          </a>
          
          
            <ul>
              
              
              


              
                
                    




  
      <li data-nav-id="/045_contribute/20_documentation/25_markup/attachments/" title="Attachments" class="dd-item ">
        <a href="/045_contribute/20_documentation/25_markup/attachments/">
            Attachments
        </a>
    </li>
  


                
              
                
                    




  
      <li data-nav-id="/045_contribute/20_documentation/25_markup/button/" title="Button" class="dd-item ">
        <a href="/045_contribute/20_documentation/25_markup/button/">
            Button
        </a>
    </li>
  


                
              
                
                    




  
      <li data-nav-id="/045_contribute/20_documentation/25_markup/expand/" title="Expand" class="dd-item ">
        <a href="/045_contribute/20_documentation/25_markup/expand/">
            Expand
        </a>
    </li>
  


                
              
                
                    




  
      <li data-nav-id="/045_contribute/20_documentation/25_markup/mermaid/" title="Mermaid" class="dd-item ">
        <a href="/045_contribute/20_documentation/25_markup/mermaid/">
            Mermaid
        </a>
    </li>
  


                
              
                
                    




  
      <li data-nav-id="/045_contribute/20_documentation/25_markup/notice/" title="Notice" class="dd-item ">
        <a href="/045_contribute/20_documentation/25_markup/notice/">
            Notice
        </a>
    </li>
  


                
              

            </ul>
        
      
    </li>
  


                
              

            </ul>
        
      
    </li>
  


                
              

            </ul>
        
      
    </li>
  


            
                 
                 




  
    
    <li data-nav-id="/tutorials/" title="Tutorials" class="dd-item
        parent
        
        
        ">
        
          <a href="/tutorials/">
              
              <img class="navigation-icon" src="https://gardener.cloud/images/navigation_tutorials.svg"/>
              
              Tutorials
          </a>
          
          
            <ul>
              
              
                
              
              


              
                
                    




  
    
    <li data-nav-id="/using-gardener/administrator/" title="Administrator" class="dd-item
        
        
        
        ">
        
          <a href="/using-gardener/administrator/">
              
              Administrator
          </a>
          
          
      
    </li>
  


                
              
                
                    




  
    
    <li data-nav-id="/using-gardener/developer/topic/" title="App Developer" class="dd-item
        
        
        
        ">
        
          <a href="/using-gardener/developer/topic/">
              
              App Developer
          </a>
          
          
      
    </li>
  


                
              
                
                
              

            </ul>
        
      
    </li>
  


            
                 
                 




  
    
    <li data-nav-id="/curated-links/" title="Curated Links" class="dd-item
        
        
        
        ">
        
          <a href="/curated-links/">
              
              <img class="navigation-icon" src="https://gardener.cloud/images/navigation_links.svg"/>
              
              Curated Links
          </a>
          
          
      
    </li>
  


            
                 
                 




  
    
    <li data-nav-id="/api-reference/" title="API Reference" class="dd-item
        
        
        
        ">
        
          <a href="/api-reference/">
              
              <img class="navigation-icon" src="https://gardener.cloud/images/navigation_tutorials.svg"/>
              
              API Reference
          </a>
          
          
            <ul>
              
              
                
              
              


              
                
                    




  
    
    <li data-nav-id="/api-reference/core/" title="Core" class="dd-item
        
        
        
        ">
        
          <a href="/api-reference/core/">
              
              Core
          </a>
          
          
      
    </li>
  


                
              
                
                    




  
    
    <li data-nav-id="/api-reference/extensions/" title="Extensions" class="dd-item
        
        
        
        ">
        
          <a href="/api-reference/extensions/">
              
              Extensions
          </a>
          
          
      
    </li>
  


                
              
                
                    




  
    
    <li data-nav-id="/api-reference/garden/" title="Garden" class="dd-item
        
        
        
        ">
        
          <a href="/api-reference/garden/">
              
              Garden
          </a>
          
          
      
    </li>
  


                
              
                
                    




  
    
    <li data-nav-id="/api-reference/settings/" title="Settings" class="dd-item
        
        
        
        ">
        
          <a href="/api-reference/settings/">
              
              Settings
          </a>
          
          
      
    </li>
  


                
              

            </ul>
        
      
    </li>
  


            
                 
                 




  
    
    <li data-nav-id="/adopter/" title="" class="dd-item
        
        
        
        ">
        
          <a href="/adopter/">
              
              
          </a>
          
          
      
    </li>
  


            
                 
                 




  
    
    <li data-nav-id="/blog/" title="" class="dd-item
        
        
        
        ">
        
          <a href="/blog/">
              
              
          </a>
          
          
      
    </li>
  


            
                 
                 




  
    
    <li data-nav-id="/community/" title="" class="dd-item
        
        
        
        ">
        
          <a href="/community/">
              
              
          </a>
          
          
      
    </li>
  


            
                 
                 




  
    
    <li data-nav-id="/installer/" title="" class="dd-item
        
        
        
        ">
        
          <a href="/installer/">
              
              
          </a>
          
          
      
    </li>
  


            
      </ul>
      <section id="footer">
        
<script async defer src="https://buttons.github.io/buttons.js"></script>

      </section>

  </div>
</nav>











        <section id="body">
        <div id="overlay"></div>
        <div class="padding highlightable  body-inner-wrapper">
              
              <div>
                <div id="top-bar">
                
                  
                  
                  
                  <div id="top-github-link">
                    <a class="github-link" title='Edit this page' href="https://github.com/gardener/documentation/edit/master/website/documentation/050-tutorials/content/howto/prometheus/_index.md" target="blank">
                      <i class="fa fa-code-fork"></i>
                      <span id="top-github-link-text">Edit this page</span>
                    </a>
                  </div>
                  
                
                
                <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
                    <span id="sidebar-toggle-span">
                        <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                          <i class="fa fa-bars"></i>
                        </a>
                    </span>
                  
                  <span id="toc-menu"><i class="fa fa-list-alt"></i></span>
                  
                  <span class="links">
                    
            
            
                
                    
                    
            
            
                
                    
                    
            
            
                
                    
                    
            
            
                
                    
                    
            
            
              <a href='/'>Gardener</a> > <a href='/tutorials/'>Tutorials</a> > Using Prometheus and Grafana to monitor K8s
            
          
                
            
          
                
            
          
                
            
          
                
            
          
                  </span>
                </div>
                
                    <div class="progress">
    <div class="wrapper">
<nav id="TableOfContents">
<ul>
<li>
<ul>
<li><a href="#disclaimer">Disclaimer</a></li>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#preparation">Preparation</a></li>
<li><a href="#deployment-of-prometheus-and-grafana">Deployment of Prometheus and Grafana</a></li>
<li><a href="#basic-functional-tests">Basic functional tests</a></li>
<li><a href="#links">Links</a></li>
</ul></li>
</ul>
</nav>
    </div>
</div>

                
              </div>
            </div>
            <div class="tutorial-last-update">Updated <span>


   <span id="53ca02fc9e9f2df01846e0dbd4f1b8a9"></span>
   <script>$("#53ca02fc9e9f2df01846e0dbd4f1b8a9").html(moment("2019-03-23T17:43:09Z").fromNow())</script>


</span> by 


   

   

   

   

<a href='mailto:i.alidjikov@gmail.com'>ialidzhikov</a>, <a href='mailto:andreas.herz@sap.com'>Andreas Herz</a>, <a href='mailto:a.herz@freegroup.de'>Andreas Herz</a>

</div>

            


        <div id="body-inner">


          






<h2 id="disclaimer">Disclaimer</h2>

<p>This post is meant to give a basic end-to-end description for deploying and using Prometheus and Grafana. Both
applications offer a wide range of flexibility which needs to be considered in case you have specific requirenments.
Such advanced details are not in the scope of this post.</p>

<h2 id="introduction">Introduction</h2>

<p><a href="https://prometheus.io/">Prometheus</a> is an open-source systems monitoring and alerting toolkit for recording numeric
time series. It fits both machine-centric monitoring as well as monitoring of highly dynamic service-oriented
architectures. In a world of microservices, its support for multi-dimensional data collection and querying is a
particular strength.</p>

<p>Prometheus graduates within CNCF <a href="https://prometheus.io/blog/2018/08/09/prometheus-graduates-within-cncf/">second hosted project</a>.</p>

<p>The following characteristics make Prometheus a good match for monitoring Kubernetes clusters:</p>

<ul>
<li><p>Pull-based monitoring<br />
Prometheus is a <a href="https://prometheus.io/blog/2016/07/23/pull-does-not-scale-or-does-it/">pull-based</a> monitoring system,
which means that the Prometheus server dynamically discovers and pulls metrics from your services running in
Kubernetes.</p></li>

<li><p>Labels
Prometheus and Kubernetes share the same label (key-value) concept that can be used to select objects in the system.<br />
Labels are used to identify time series and sets of label matchers can be used in the query language
( <a href="https://prometheus.io/docs/prometheus/latest/querying/basics/">PromQL</a> ) to select the time series to be aggregated..</p></li>

<li><p>Exporters<br />
There are many <a href="https://prometheus.io/docs/instrumenting/exporters/">exporters</a> available which enable integration of
databases or even other monitoring systems not already providing a way to export metrics to Prometheus.
One prominent exporter is the so called <a href="https://github.com/prometheus/node_exporter">node-exporter</a>, which allows to
monitor hardware and OS related metrics of Unix systems.</p></li>

<li><p>Powerful query language<br />
The Prometheus query language <a href="https://prometheus.io/docs/prometheus/latest/querying/basics/">PromQL</a> lets the user
select and aggregate time series data in real time. Results can either be shown as a graph, viewed
as tabular data in the Prometheus expression browser, or consumed by external systems via the <a href="https://prometheus.io/docs/prometheus/latest/querying/api/">HTTP API</a>.</p></li>
</ul>

<p>Find query examples on <a href="https://github.com/infinityworks/prometheus-example-queries/blob/master/README.md">Prometheus Query Examples</a>.</p>

<p>One very popular open-source visualization tool not only for Prometheus is <a href="https://grafana.com">Grafana</a>. Grafana is a
metric analytics and visualization suite. It is popular for for visualizing time series data for infrastructure
 and application analytics but many use it in other domains including industrial sensors, home automation, weather, and
  process control [see <a href="http://docs.grafana.org/">Grafana Documentation</a>].</p>

<p>Grafana accesses data via <a href="http://docs.grafana.org/guides/basic_concepts/">Data Sources</a>. The continuously growing
list of supported backends includes Prometheus.</p>

<p>Dashboards are created by combining panels, e.g. <a href="http://docs.grafana.org/reference/graph/">Graph</a> and <a href="http://docs.grafana.org/reference/dashlist/">Dashlist</a>.</p>

<p>In this example we describe an End-To-End scenario including the deployment of Prometheus and a basic monitoring
configuration as the one provided for Kubernetes clusters created by Gardener.</p>

<p>If you miss elements on the Prometheus web page when accessing it via its service URL  <code>https://&lt;your K8s FQN&gt;/api/v1/namespaces/&lt;your-prometheus-namespace&gt;/services/prometheus-prometheus-server:80/proxy</code>
this is probably caused by Prometheus issue <a href="https://github.com/prometheus/prometheus/issues/1583">#1583</a>
To workaround this issue setup a port forward <code>kubectl port-forward -n &lt;your-prometheus-namespace&gt; &lt;prometheus-pod&gt; 9090:9090</code>
on your client and access the Prometheus UI from  there with your locally installed web browser. This issue is not relevant
in case you use the service type <code>LoadBalancer</code>.</p>

<h2 id="preparation">Preparation</h2>

<p>The deployment of <a href="https://github.com/kubernetes/charts/tree/master/stable/prometheus">Prometheus</a> and <a href="https://github.com/kubernetes/charts/tree/master/stable/grafana">Grafana</a> is based on Helm charts.<br />
Make sure to implement the <a href="/howto/helm">Helm settings</a> before deploying the Helm charts.</p>

<p>The Kubernetes clusters provided by <a href="https://github.com/gardener">Gardener</a> use role based
access control (<a href="https://kubernetes.io/docs/admin/authorization/rbac/">RBAC</a>). To authorize the Prometheus
node-exporter to access hardware and OS relevant metrics of your cluster&rsquo;s worker nodes specific artifacts need to be
deployed.</p>

<p>Bind the prometheus service account to the <code>garden.sapcloud.io:monitoring:prometheus</code> cluster role by running the command
<code>kubectl apply -f crbinding.yaml</code>.</p>

<p>Content of <code>crbinding.yaml</code></p>

<pre><code class="language-yaml">apiVersion: rbac.authorization.k8s.io/v1beta1
kind: ClusterRoleBinding
metadata:
  name: &lt;your-prometheus-name&gt;-server
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: garden.sapcloud.io:monitoring:prometheus
subjects:
- kind: ServiceAccount
  name: &lt;your-prometheus-name&gt;-server
  namespace: &lt;your-prometheus-namespace&gt;
</code></pre>

<h2 id="deployment-of-prometheus-and-grafana">Deployment of Prometheus and Grafana</h2>

<p>Only minor changes are needed to deploy <a href="https://github.com/kubernetes/charts/tree/master/stable/prometheus">Prometheus</a>
and <a href="https://github.com/kubernetes/charts/tree/master/stable/grafana">Grafana</a> based on Helm charts.</p>

<p>Copy the following configuration into a file called values.yaml and deploy Prometheus: <code>helm install --name &lt;your-prometheus-name&gt; --namespace &lt;your-prometheus-namespace&gt; stable/prometheus -f values.yaml</code></p>

<p>Typically, Prometheus and Grafana are deployed into the same namespace. There is no technical reason behind this so feel
free to choose different namespaces.</p>

<p>Content of <code>values.yaml</code> for Prometheus:</p>

<pre><code class="language-yaml">rbac:
  create: false # Already created in Preparation step
nodeExporter:
  enabled: false # The node-exporter is already deployed by default

server:
  global:
    scrape_interval: 30s
    scrape_timeout: 30s

serverFiles:
  prometheus.yml:
    rule_files:
      - /etc/config/rules
      - /etc/config/alerts      
    scrape_configs:
    - job_name: 'kube-kubelet'
      honor_labels: false
      scheme: https

      tls_config:
      # This is needed because the kubelets' certificates are not generated
      # for a specific pod IP
        insecure_skip_verify: true
      bearer_token_file: /var/run/secrets/kubernetes.io/serviceaccount/token

      kubernetes_sd_configs:
      - role: node
      relabel_configs:
      - target_label: __metrics_path__
        replacement: /metrics
      - source_labels: [__meta_kubernetes_node_address_InternalIP]
        target_label: instance
      - action: labelmap
        regex: __meta_kubernetes_node_label_(.+)

    - job_name: 'kube-kubelet-cadvisor'
      honor_labels: false
      scheme: https

      tls_config:
      # This is needed because the kubelets' certificates are not generated
      # for a specific pod IP
        insecure_skip_verify: true
      bearer_token_file: /var/run/secrets/kubernetes.io/serviceaccount/token

      kubernetes_sd_configs:
      - role: node
      relabel_configs:
      - target_label: __metrics_path__
        replacement: /metrics/cadvisor
      - source_labels: [__meta_kubernetes_node_address_InternalIP]
        target_label: instance
      - action: labelmap
        regex: __meta_kubernetes_node_label_(.+)

    # Example scrape config for probing services via the Blackbox Exporter.
    #
    # Relabelling allows to configure the actual service scrape endpoint using the following annotations:
    #
    # * `prometheus.io/probe`: Only probe services that have a value of `true`
    - job_name: 'kubernetes-services'
      metrics_path: /probe
      params:
        module: [http_2xx]
      kubernetes_sd_configs:
        - role: service
      relabel_configs:
        - source_labels: [__meta_kubernetes_service_annotation_prometheus_io_probe]
          action: keep
          regex: true
        - source_labels: [__address__]
          target_label: __param_target
        - target_label: __address__
          replacement: blackbox
        - source_labels: [__param_target]
          target_label: instance
        - action: labelmap
          regex: __meta_kubernetes_service_label_(.+)
        - source_labels: [__meta_kubernetes_namespace]
          target_label: kubernetes_namespace
        - source_labels: [__meta_kubernetes_service_name]
          target_label: kubernetes_name
    # Example scrape config for pods
    #
    # Relabelling allows to configure the actual service scrape endpoint using the following annotations:
    #
    # * `prometheus.io/scrape`: Only scrape pods that have a value of `true`
    # * `prometheus.io/path`: If the metrics path is not `/metrics` override this.
    # * `prometheus.io/port`: Scrape the pod on the indicated port instead of the default of `9102`.
    - job_name: 'kubernetes-pods'
      kubernetes_sd_configs:
        - role: pod
      relabel_configs:
        - source_labels: [__meta_kubernetes_pod_annotation_prometheus_io_scrape]
          action: keep
          regex: true
        - source_labels: [__meta_kubernetes_pod_annotation_prometheus_io_path]
          action: replace
          target_label: __metrics_path__
          regex: (.+)
        - source_labels: [__address__, __meta_kubernetes_pod_annotation_prometheus_io_port]
          action: replace
          regex: (.+):(?:\d+);(\d+)
          replacement: ${1}:${2}
          target_label: __address__
        - action: labelmap
          regex: __meta_kubernetes_pod_label_(.+)
        - source_labels: [__meta_kubernetes_namespace]
          action: replace
          target_label: kubernetes_namespace
        - source_labels: [__meta_kubernetes_pod_name]
          action: replace
          target_label: kubernetes_pod_name
    # Scrape config for service endpoints.
    #
    # The relabeling allows the actual service scrape endpoint to be configured
    # via the following annotations:
    #
    # * `prometheus.io/scrape`: Only scrape services that have a value of `true`
    # * `prometheus.io/scheme`: If the metrics endpoint is secured then you will need
    # to set this to `https` &amp; most likely set the `tls_config` of the scrape config.
    # * `prometheus.io/path`: If the metrics path is not `/metrics` override this.
    # * `prometheus.io/port`: If the metrics are exposed on a different port to the
    # service then set this appropriately.
    - job_name: 'kubernetes-service-endpoints'
      kubernetes_sd_configs:
        - role: endpoints
      relabel_configs:
        - source_labels: [__meta_kubernetes_service_annotation_prometheus_io_scrape]
          action: keep
          regex: true
        - source_labels: [__meta_kubernetes_service_annotation_prometheus_io_scheme]
          action: replace
          target_label: __scheme__
          regex: (https?)
        - source_labels: [__meta_kubernetes_service_annotation_prometheus_io_path]
          action: replace
          target_label: __metrics_path__
          regex: (.+)
        - source_labels: [__address__, __meta_kubernetes_service_annotation_prometheus_io_port]
          action: replace
          target_label: __address__
          regex: (.+)(?::\d+);(\d+)
          replacement: $1:$2
        - action: labelmap
          regex: __meta_kubernetes_service_label_(.+)
        - source_labels: [__meta_kubernetes_namespace]
          action: replace
          target_label: kubernetes_namespace
        - source_labels: [__meta_kubernetes_service_name]
          action: replace
          target_label: kubernetes_name # Add your additional configuration here...
</code></pre>

<p>Next, deploy Grafana. Since the deployment in this post is based on the Helm default values, the settings below are set
explicitly in case the default changed.
Deploy Grafana via <code>helm install --name grafana --namespace &lt;your-prometheus-namespace&gt; stable/grafana -f values.yaml</code>. Here, the same namespace is chosen for Prometheus and for Grafana.</p>

<p>Content of <code>values.yaml</code> for Grafana:</p>

<pre><code class="language-yaml">server:
  ingress:
    enabled: false
  service:
    type: ClusterIP
</code></pre>

<p>Check the running state of the pods on the Kubernetes Dashboard or by running <code>kubectl get pods -n &lt;your-prometheus-namespace&gt;</code>.
In case of errors check the log files of the pod(s) in question.</p>

<p>The text output of Helm after the deployment of Prometheus and Grafana contains very useful information, e.g. the user
and password of the Grafana Admin user. The credentials are stored as secrets in the namespace <code>&lt;your-prometheus-namespace&gt;</code>
and could be decoded via <code>kubectl get secret --namespace &lt;my-grafana-namespace&gt; grafana -o jsonpath=&quot;{.data.admin-password}&quot; | base64 --decode ; echo</code>.</p>

<h2 id="basic-functional-tests">Basic functional tests</h2>

<p>To access the web UI of both applications use port forwarding of port 9090.</p>

<p>Setup port forwarding for port 9090:</p>

<pre><code class="language-bash">kubectl port-forward -n &lt;your-prometheus-namespace&gt; &lt;your-prometheus-server-pod&gt; 9090:9090
</code></pre>

<p>Open <code>http://localhost:9090</code> in your web browser. Select Graph from the top tab and enter the following expressing to show the overall CPU usage for a server
(see <a href="https://github.com/infinityworks/prometheus-example-queries/blob/master/README.md">Prometheus Query Examples</a>)</p>

<pre><code>100 * (1 - avg by(instance)(irate(node_cpu{mode='idle'}[5m])))
</code></pre>

<p>This should show some data in a graph.</p>

<p>To show the same data in Grafana setup port forwarding for port 3000 for the
Grafana pod and open the Grafana Web UI by opening <a href="http://localhost:3000">http://localhost:3000</a> in a browser.
Enter the credentials of the admin user.</p>

<p>Next, you need to enter the server name of your Prometheus deployment. This name is shown directly after the
installation via helm.</p>

<p>Run</p>

<pre><code class="language-bash">helm status &lt;your-prometheus-name&gt;
</code></pre>

<p>to find this name. Below this server name is referenced by <code>&lt;your-prometheus-server-name&gt;</code>.</p>

<p>First, you need to add your Prometheus server as data source.</p>

<ul>
<li>select <em>Dashboards &rightarrow; Data Sources</em></li>
<li>select <em>Add data source</em></li>
<li>enter
<em>Name</em>: <code>&lt;your-prometheus-datasource-name&gt;</code><br />
<em>Type</em>: Prometheus<br />
<em>URL</em>: <code>http://&lt;your-prometheus-server-name&gt;</code><br />
_Access: <code>proxy</code><br /></li>
<li>select <em>Save &amp; Test</em></li>
</ul>

<p>In case of failure check the Prometheus URL in the Kubernetes Dashboard.</p>

<p>To add a Graph follow these steps:</p>

<ul>
<li>in the left corner, select <em>Dashboards &rightarrow; New</em> to create a new dashboard</li>
<li>select <em>Graph</em> to create a new graph</li>
<li>next, select the <em>Panel Title &rightarrow; Edit</em></li>
<li>select your Prometheus Data Source in the drop down list</li>
<li>enter the expression <code>100 * (1 - avg by(instance)(irate(node_cpu{mode='idle'}[5m])))</code> in the entry field A</li>
<li>select the floppy disk symbol (Save) on top</li>
</ul>

<p>Now you should have a very basic Prometheus and Grafana setup for your Kubernetes cluster.</p>

<p>As a next step you can implement monitoring for your applications by implementing the <a href="https://prometheus.io/docs/instrumenting/clientlibs/">Prometheus client API</a>.</p>

<h2 id="links">Links</h2>

<ul>
<li><a href="https://prometheus.io/">Prometheus</a></li>
<li><a href="https://github.com/kubernetes/charts/tree/master/stable/prometheus">Prometheus Helm Chart</a></li>
<li><a href="https://www.weave.works/blog/prometheus-kubernetes-perfect-match/">Prometheus and Kubernetes: A Perfect Match</a></li>
<li><a href="https://grafana.com">Grafana</a></li>
<li><a href="https://github.com/kubernetes/charts/tree/master/stable/grafana">Grafana Helm Chart</a></li>
</ul>



<footer class=" footline" >
</footer>




        </div> 
        

      </div>


        
        

        
            
            <div class="howto_tickets">
                <span class="open_github_ticket">
                    <h3 class="open_github_ticket_header"><img src="https://gardener.cloud/images/github.svg"/> Report an issue</h3>
                    See a typo? Have a picture to recommend? Want to edit some words/phrases/sentences?
                    You can simply submit a ticket to request we make the change. If you are github savvy, submit a
                    pull request.
                    <a href="#" onclick="return createIssue('https:\/\/github.com\/gardener\/documentation\/issues/new','050-tutorials\/content\/howto\/prometheus\/_index.md','https:\/\/github.com\/gardener\/documentation\/edit\/master\/website\/documentation\/050-tutorials\/content\/howto\/prometheus\/_index.md')" target="_blank">Open Github Issue <i class="fa fa-external-link" aria-hidden="true"></i></a>
                    <br>
                </span>
            </div>

        


    </section>
    
    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">

      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="/js/clipboard.min.js?1578319962"></script>
    <script src="/js/perfect-scrollbar.min.js?1578319962"></script>
    <script src="/js/perfect-scrollbar.jquery.min.js?1578319962"></script>
    <script src="/js/jquery.sticky.js?1578319962"></script>
    <script src="/js/featherlight.min.js?1578319962"></script>
    <script src="/js/html5shiv-printshiv.min.js?1578319962"></script>
    <script src="/js/highlight.pack.js?1578319962"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="/js/modernizr.custom.71422.js?1578319962"></script>
    <script src="/js/learn.js?1578319962"></script>
    <script src="/js/hugo-learn.js?1578319962"></script>

    <link href="/mermaid/mermaid.css?1578319962" type="text/css" rel="stylesheet" />
    <script src="/mermaid/mermaid.js?1578319962"></script>
    <script>
        mermaid.initialize({ startOnLoad: true, htmlLables: true });
        function createIssue(issueUrl, page, url) {
            var uri = issueUrl+"?title=Documentation issue on page \""+page+"\"";
            uri = uri+ "&body=\n\n<- DESCRIBE MISSING OR FAULTY DOCUMENTATION HERE->\n\n---\nPage: ["+ page +"]("+
            url+ ")\ndon't remove the link to the page. It's required for the processor"
            var res = encodeURI(uri);
            res +="&labels=area/documentation"
            window.open(res,"issue")
            return false;
        }

        $(document).ready(function() {
            var $window = $(window);
            $window.sr = ScrollReveal({ reset: false});
            $window.sr.reveal('.reveal-fast', { duration: 2000 });
            $window.sr.reveal('.reveal-slow', { duration: 2500 });
            $window.sr.reveal('.reveal-right', { duration: 2000, origin:'right', distance:'300px' });
            $window.sr.reveal('.reveal-left', { duration: 2000, origin:'left', distance:'300px' });

            inlineSVG.init();
        });

    </script>
    
    <script>
    
    
    function setMenuHeight() {
        $('#sidebar .highlightable').height($('#sidebar').innerHeight() - $('#header-wrapper').height() - 40);
        $('#sidebar .highlightable').perfectScrollbar('update');
        var $blockList = $('#sidebar .highlightable');
        if ($blockList.length && window.localStorage) {
            var position = localStorage.getItem('blockListScrollPosition');
            if (position) {
                $blockList.scrollTop(position);
            }
            $(window).on('unload', function () {
                var scrollPosition = $blockList.scrollTop();
                localStorage.setItem('blockListScrollPosition', scrollPosition);
            });
        }
    }

    
    
    (function () {
        $("#body-inner a").not(".inline")
            .each(function () {
                if (this.hostname != window.location.hostname && this.href.indexOf("mailto:")===-1) {
                    this.target = '_blank';
                    $(this).addClass("externalLink");
                    if($(this).find("img").length===0) {
                        this.innerHTML += '<i class="fa fa-external-link" aria-hidden="true"></i>';
                    }
                }
            });



    })();

    </script>
  </body>
</html>
