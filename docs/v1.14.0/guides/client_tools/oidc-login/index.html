<!doctype html><html lang=en class="js csstransforms3d"><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Project Gardener Website - A Managed Kubernetes Service Done Right"><meta name=copyright content="Copyright 2019 Gardener project authors."><meta name=google-site-verification content="9EoGiMwk2aq0E_tVh16iJgJbp7fbyqkfWH9b5sGybl0"><title>Authenticating with an Identity Provider :: Gardener</title><link rel=icon type=image/x-icon href=https://gardener.cloud/images/favicon.ico><link rel=icon type=image/png href=https://gardener.cloud/images/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=https://gardener.cloud/images/favicon-16x16.png sizes=16x16><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);})(window,document,'script','dataLayer','GTM-W2FGNSX');</script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}
gtag('js',new Date());gtag('config','UA-165447164-1');</script><link href=/css/nucleus.css?1613639388 rel=stylesheet><link href=/css/font-awesome.min.css?1613639388 rel=stylesheet><link href=/css/hybrid.css?1613639388 rel=stylesheet><link href=/css/featherlight.min.css?1613639388 rel=stylesheet><link href=/css/perfect-scrollbar.min.css?1613639388 rel=stylesheet><link href=/css/auto-complete.css?1613639388 rel=stylesheet><link href=/css/skeleton.css?1613639388 rel=stylesheet><link href=/css/sheetslider.css?1613639388 rel=stylesheet><link rel=stylesheet href=/css/gardener.7593938070d708e7b1bec0e9172492ff8f780d7c20e680f994075d57795a3335.css><script src=/js/moment.js?1613639388></script><script src=/js/vivus.js?1613639388></script><script src=/js/scrollreveal.js?1613639388></script><script src=/js/inlineSVG.js?1613639388></script><script src=/js/jquery.min.js?1613639388></script><script src=/js/fixed.js?1613639388></script><script src=/js/clipboard.min.js?1613639388></script><script src=https://platform.linkedin.com/in.js type=text/javascript>lang:en_US</script></head><body data-url=/v1.14.0/guides/client_tools/oidc-login/ class=has-sticky-navigation><script>$(document).ready(function(){function initStickyNav(){var stickyPoint;var tln=document.querySelector(".tln");if(!tln){return;}
var stickyPointEl=document.querySelector(".sticky-nav-point");if(stickyPointEl==null){stickyPointEl=document.querySelector("body");stickyPoint=0;}else{stickyPoint=stickyPointEl.clientHeight+stickyPointEl.offsetTop;}
var bodySelector=document.getElementsByTagName("body")[0];var tlnHeight=tln.clientHeight;var stickyNavigation=function(){if(window.pageYOffset+tlnHeight>=stickyPoint){bodySelector.classList.add("has-sticky-navigation");tln.classList.add("sticky-top");}else{bodySelector.classList.remove("has-sticky-navigation");tln.classList.remove("sticky-top");}}
window.onscroll=function(){stickyNavigation();};}
initStickyNav();function closeAllSelect(){document.getElementById("docOptions").classList.remove("show");}
function show(e){e.stopPropagation();document.getElementById("docOptions").classList.add("show");}
document.addEventListener("click",closeAllSelect);document.getElementById("docSelector").addEventListener("click",show);});</script><div class="tln fixedsticky sticky-top"><header class=navigation><div class=container><div class=navigation-wrapper><a href=/ class=logo><img src=/images/logo.svg>
<span class=title>Gardener</span></a>
<a class="nav-button navbar-toggler" href=#><i class="fa fa-bars"></i></a><div class=navbar-collapse><ul class=links><li class=link><a href=/blog/>Blogs</a></li><li class=link><a href=/community/>Community</a></li><li class=link><a href=/adopter/>Adopters</a></li><li class="link has-child"><a href=/documentation/home>Documentation</a></li></ul></div></div></div></header></div><script>$(".navigation .navbar-toggler").click(function(evt){$(".navigation .navbar-collapse").toggle();$(".navigation").toggleClass("collapsed");$(".navigation .search-box").toggle();})</script><style>#docSelector{cursor:pointer}.doc-options{position:fixed;background-color:#0b8062;text-align:left;display:none}.doc-options ul li{margin-bottom:0}.doc-options ul li a:hover{background-color:#0c694f}.doc-options ul{list-style:none;padding:0;margin:0;text-align:left}.doc-options ul li a{padding:10px;margin:0}.doc-options .activeVersion{background-color:#ec682a}.show{display:block}</style><div class=sln><div class=overlay-band><ul class="nav-list container"><li title=Home><a class=navbar-link href=/v1.14.0/home/>Home</a></li><li title=Concepts><a class=navbar-link href=/v1.14.0/concepts/>Concepts</a></li><li title="How-To Guides"><a class="navbar-link is-active" href=/v1.14.0/guides/>How-To Guides</a></li><li title=Tutorials><a class=navbar-link href=/v1.14.0/tutorials/>Tutorials</a></li><li title="API Reference"><a class=navbar-link href=/v1.14.0/references/>API Reference</a></li><li title=Contribute><a class=navbar-link href=/v1.14.0/contribute/>Contribute</a></li></ul></div></div><div class="main container"><nav id=sidebar class="collapsed container menu"><div class=highlightable><ul class=topics><li data-nav-id=/v1.14.0/guides/ title="How-To Guides" class="dd-item parent root collapsible" data-depth=0><a href=/v1.14.0/guides/><span class=menu-item-text>How-To Guides</span></a><ul><li data-nav-id=/v1.14.0/guides/client_tools/ title="Set Up Client Tools" class="dd-item parent top-level collapsible" data-depth=1><a href=/v1.14.0/guides/client_tools/><span class="toggle fa fa-angle-down"></span><span class=menu-item-text>Set Up Client Tools</span></a><ul><li data-nav-id=/v1.14.0/guides/client_tools/oidc-login/ title="Authenticating with an Identity Provider" class="dd-item parent active" data-depth=2><a href=/v1.14.0/guides/client_tools/oidc-login/><span class=toggle></span><span class=menu-item-text>Authenticating with an Identity Provider</span></a></li><li data-nav-id=/v1.14.0/guides/client_tools/kubectl-apiserver/ title="Automated deployment" class=dd-item data-depth=2><a href=/v1.14.0/guides/client_tools/kubectl-apiserver/><span class=toggle></span><span class=menu-item-text>Automated deployment</span></a></li><li data-nav-id=/v1.14.0/guides/client_tools/bash_kubeconfig/ title="Kubeconfig context as bash prompt" class=dd-item data-depth=2><a href=/v1.14.0/guides/client_tools/bash_kubeconfig/><span class=toggle></span><span class=menu-item-text>Kubeconfig context as bash prompt</span></a></li><li data-nav-id=/v1.14.0/guides/client_tools/working-with-kubeconfig/ title="Organizing Access Using kubeconfig Files" class=dd-item data-depth=2><a href=/v1.14.0/guides/client_tools/working-with-kubeconfig/><span class=toggle></span><span class=menu-item-text>Organizing Access Using kubeconfig Files</span></a></li><li data-nav-id=/v1.14.0/guides/client_tools/helm/ title="Use a Helm chart to deploy some application or service" class=dd-item data-depth=2><a href=/v1.14.0/guides/client_tools/helm/><span class=toggle></span><span class=menu-item-text>Use a Helm chart to deploy some application or service</span></a></li></ul></li><li data-nav-id=/v1.14.0/guides/install_gardener/ title="Install Gardener" class="dd-item top-level collapsible collapsed" data-depth=1><a href=/v1.14.0/guides/install_gardener/><span class="toggle fa fa-angle-right"></span><span class=menu-item-text>Install Gardener</span></a><ul><li data-nav-id=/v1.14.0/guides/install_gardener/setup/ title="Gardener DNS Management for Shoots" class=dd-item data-depth=2><a href=/v1.14.0/guides/install_gardener/setup/><span class=toggle></span><span class=menu-item-text></span>Gardener DNS Management for Shoots</span></a></a></li><li data-nav-id=/v1.14.0/guides/install_gardener/secure-setup/ title="Hardening the Gardener Community Setup" class=dd-item data-depth=2><a href=/v1.14.0/guides/install_gardener/secure-setup/><span class=toggle></span><span class=menu-item-text>Hardening the Gardener Community Setup</span></a></li><li data-nav-id=/v1.14.0/guides/install_gardener/landscape-setup/ title="Landscape Setup" class=dd-item data-depth=2><a href=/v1.14.0/guides/install_gardener/landscape-setup/><span class=toggle></span><span class=menu-item-text>Landscape Setup</span></a></li><li data-nav-id=/v1.14.0/guides/install_gardener/add-node-to-cluster/ title="Manually adding a node to an existing cluster" class=dd-item data-depth=2><a href=/v1.14.0/guides/install_gardener/add-node-to-cluster/><span class=toggle></span><span class=menu-item-text>Manually adding a node to an existing cluster</span></a></li><li data-nav-id=/v1.14.0/guides/install_gardener/setup-seed/ title="Setting up a Seed Cluster" class=dd-item data-depth=2><a href=/v1.14.0/guides/install_gardener/setup-seed/><span class=toggle></span><span class=menu-item-text>Setting up a Seed Cluster</span></a></li></ul></li><li data-nav-id=/v1.14.0/guides/administer_shoots/ title="Administer Client (Shoot) Clusters" class="dd-item top-level collapsible collapsed" data-depth=1><a href=/v1.14.0/guides/administer_shoots/><span class="toggle fa fa-angle-right"></span><span class=menu-item-text>Administer Client (Shoot) Clusters</span></a><ul><li data-nav-id=/v1.14.0/guides/administer_shoots/hibernate-cluster/ title="Hibernate a Cluster" class=dd-item data-depth=2><a href=/v1.14.0/guides/administer_shoots/hibernate-cluster/><span class=toggle></span><span class=menu-item-text>Hibernate a Cluster</span></a></li><li data-nav-id=/v1.14.0/guides/administer_shoots/create-delete-shoot/ title="Create / Delete a Shoot cluster" class=dd-item data-depth=2><a href=/v1.14.0/guides/administer_shoots/create-delete-shoot/><span class=toggle></span><span class=menu-item-text>Create / Delete a Shoot cluster</span></a></li><li data-nav-id=/v1.14.0/guides/administer_shoots/gardener_aws/ title="Create a kubernetes cluster in AWS with Gardener" class=dd-item data-depth=2><a href=/v1.14.0/guides/administer_shoots/gardener_aws/><span class=toggle></span><span class=menu-item-text>Create a kubernetes cluster in AWS with Gardener</span></a></li><li data-nav-id=/v1.14.0/guides/administer_shoots/gardener_gcp/ title="Create a kubernetes cluster on GCP with Gardener" class=dd-item data-depth=2><a href=/v1.14.0/guides/administer_shoots/gardener_gcp/><span class=toggle></span><span class=menu-item-text>Create a kubernetes cluster on GCP with Gardener</span></a></li><li data-nav-id=/v1.14.0/guides/administer_shoots/create-shoot-into-existing-aws-vpc/ title="Create a Shoot cluster into existing AWS VPC" class=dd-item data-depth=2><a href=/v1.14.0/guides/administer_shoots/create-shoot-into-existing-aws-vpc/><span class=toggle></span><span class=menu-item-text>Create a Shoot cluster into existing AWS VPC</span></a></li><li data-nav-id=/v1.14.0/guides/administer_shoots/gardener-alibaba/ title="Create Shoot Clusters in Alibaba Cloud" class=dd-item data-depth=2><a href=/v1.14.0/guides/administer_shoots/gardener-alibaba/><span class=toggle></span><span class=menu-item-text>Create Shoot Clusters in Alibaba Cloud</span></a></li><li data-nav-id=/v1.14.0/guides/administer_shoots/dns_providers/ title="Manage DNS Providers" class=dd-item data-depth=2><a href=/v1.14.0/guides/administer_shoots/dns_providers/><span class=toggle></span><span class=menu-item-text></span>Manage DNS Providers</span></a></a></li><li data-nav-id=/v1.14.0/guides/administer_shoots/dns_names/ title="Request DNS Names" class=dd-item data-depth=2><a href=/v1.14.0/guides/administer_shoots/dns_names/><span class=toggle></span><span class=menu-item-text></span>Request DNS Names</span></a></a></li><li data-nav-id=/v1.14.0/guides/administer_shoots/request_cert/ title="Request X.509 Certificates" class=dd-item data-depth=2><a href=/v1.14.0/guides/administer_shoots/request_cert/><span class=toggle></span><span class=menu-item-text></span>Request X.509 Certificates</span></a></a></li><li data-nav-id=/v1.14.0/guides/administer_shoots/maintain-shoot/ title="Shoot Cluster Maintenance" class=dd-item data-depth=2><a href=/v1.14.0/guides/administer_shoots/maintain-shoot/><span class=toggle></span><span class=menu-item-text>Shoot Cluster Maintenance</span></a></li><li data-nav-id=/v1.14.0/guides/administer_shoots/trigger-shoot-operations/ title="Trigger Shoot operations" class=dd-item data-depth=2><a href=/v1.14.0/guides/administer_shoots/trigger-shoot-operations/><span class=toggle></span><span class=menu-item-text></span>Trigger Shoot operations</span></a></a></li><li data-nav-id=/v1.14.0/guides/administer_shoots/trigger-shoot-operations/ title="Trigger Shoot operations" class=dd-item data-depth=2><a href=/v1.14.0/guides/administer_shoots/trigger-shoot-operations/><span class=toggle></span><span class=menu-item-text>Trigger Shoot operations</span></a></li></ul></li><li data-nav-id=/v1.14.0/guides/monitoring_and_troubleshooting/ title="Monitor and Troubleshoot" class="dd-item top-level collapsible collapsed" data-depth=1><a href=/v1.14.0/guides/monitoring_and_troubleshooting/><span class="toggle fa fa-angle-right"></span><span class=menu-item-text>Monitor and Troubleshoot</span></a><ul><li data-nav-id=/v1.14.0/guides/monitoring_and_troubleshooting/shell-to-node/ title="Get a Shell to a Gardener Shoot Worker Node" class=dd-item data-depth=2><a href=/v1.14.0/guides/monitoring_and_troubleshooting/shell-to-node/><span class=toggle></span><span class=menu-item-text>Get a Shell to a Gardener Shoot Worker Node</span></a></li><li data-nav-id=/v1.14.0/guides/monitoring_and_troubleshooting/debug-a-pod/ title="How to debug a pod" class=dd-item data-depth=2><a href=/v1.14.0/guides/monitoring_and_troubleshooting/debug-a-pod/><span class=toggle></span><span class=menu-item-text>How to debug a pod</span></a></li><li data-nav-id=/v1.14.0/guides/monitoring_and_troubleshooting/tail-logfile/ title="tail -f /var/log/my-application.log" class=dd-item data-depth=2><a href=/v1.14.0/guides/monitoring_and_troubleshooting/tail-logfile/><span class=toggle></span><span class=menu-item-text>tail -f /var/log/my-application.log</span></a></li></ul></li><li data-nav-id=/v1.14.0/guides/applications/ title=Applications class="dd-item top-level collapsible collapsed" data-depth=1><a href=/v1.14.0/guides/applications/><span class="toggle fa fa-angle-right"></span><span class=menu-item-text>Applications</span></a><ul><li data-nav-id=/v1.14.0/guides/applications/access_pod_from_local/ title="Access a port of a pod locally" class=dd-item data-depth=2><a href=/v1.14.0/guides/applications/access_pod_from_local/><span class=toggle></span><span class=menu-item-text>Access a port of a pod locally</span></a></li><li data-nav-id=/v1.14.0/guides/applications/service-access/ title="Access service from outside Kubernetes cluster" class=dd-item data-depth=2><a href=/v1.14.0/guides/applications/service-access/><span class=toggle></span><span class=menu-item-text>Access service from outside Kubernetes cluster</span></a></li><li data-nav-id=/v1.14.0/guides/applications/insecure-configuration/ title="Auditing Kubernetes for Secure Setup" class=dd-item data-depth=2><a href=/v1.14.0/guides/applications/insecure-configuration/><span class=toggle></span><span class=menu-item-text>Auditing Kubernetes for Secure Setup</span></a></li><li data-nav-id=/v1.14.0/guides/applications/missing-registry-permission/ title="Container image not pulled" class=dd-item data-depth=2><a href=/v1.14.0/guides/applications/missing-registry-permission/><span class=toggle></span><span class=menu-item-text>Container image not pulled</span></a></li><li data-nav-id=/v1.14.0/guides/applications/image-pull-policy/ title="Container image not updating" class=dd-item data-depth=2><a href=/v1.14.0/guides/applications/image-pull-policy/><span class=toggle></span><span class=menu-item-text>Container image not updating</span></a></li><li data-nav-id=/v1.14.0/guides/applications/secure-seccomp/ title="Custom Seccomp profile" class=dd-item data-depth=2><a href=/v1.14.0/guides/applications/secure-seccomp/><span class=toggle></span><span class=menu-item-text>Custom Seccomp profile</span></a></li><li data-nav-id=/v1.14.0/guides/applications/dockerfile_pitfall/ title="Dockerfile pitfalls" class=dd-item data-depth=2><a href=/v1.14.0/guides/applications/dockerfile_pitfall/><span class=toggle></span><span class=menu-item-text>Dockerfile pitfalls</span></a></li><li data-nav-id=/v1.14.0/guides/applications/https/ title="HTTPS with self Signed Certificate" class=dd-item data-depth=2><a href=/v1.14.0/guides/applications/https/><span class=toggle></span><span class=menu-item-text></span>HTTPS with self Signed Certificate</span></a></a></li><li data-nav-id=/v1.14.0/guides/applications/https/ title="HTTPS with self Signed Certificate" class=dd-item data-depth=2><a href=/v1.14.0/guides/applications/https/><span class=toggle></span><span class=menu-item-text>HTTPS with self Signed Certificate</span></a></li><li data-nav-id=/v1.14.0/guides/applications/content_trust/ title="Integrity and Immutability" class=dd-item data-depth=2><a href=/v1.14.0/guides/applications/content_trust/><span class=toggle></span><span class=menu-item-text>Integrity and Immutability</span></a></li><li data-nav-id=/v1.14.0/guides/applications/antipattern/ title="Kubernetes Antipatterns" class=dd-item data-depth=2><a href=/v1.14.0/guides/applications/antipattern/><span class=toggle></span><span class=menu-item-text>Kubernetes Antipatterns</span></a></li><li data-nav-id=/v1.14.0/guides/applications/network-isolation/ title="Namespace Isolation" class=dd-item data-depth=2><a href=/v1.14.0/guides/applications/network-isolation/><span class=toggle></span><span class=menu-item-text>Namespace Isolation</span></a></li><li data-nav-id=/v1.14.0/guides/applications/container-startup/ title="Orchestration of container startup" class=dd-item data-depth=2><a href=/v1.14.0/guides/applications/container-startup/><span class=toggle></span><span class=menu-item-text>Orchestration of container startup</span></a></li><li data-nav-id=/v1.14.0/guides/applications/service-cache-control/ title="Out-Dated HTML and JS files delivered" class=dd-item data-depth=2><a href=/v1.14.0/guides/applications/service-cache-control/><span class=toggle></span><span class=menu-item-text>Out-Dated HTML and JS files delivered</span></a></li><li data-nav-id=/v1.14.0/guides/applications/commit_secret_fail/ title="Storing secrets in git 💀" class=dd-item data-depth=2><a href=/v1.14.0/guides/applications/commit_secret_fail/><span class=toggle></span><span class=menu-item-text>Storing secrets in git 💀</span></a></li><li data-nav-id=/v1.14.0/guides/applications/prometheus/ title="Using Prometheus and Grafana to monitor K8s" class=dd-item data-depth=2><a href=/v1.14.0/guides/applications/prometheus/><span class=toggle></span><span class=menu-item-text>Using Prometheus and Grafana to monitor K8s</span></a></li></ul></li><li data-nav-id=/v1.14.0/guides/gardener-cookies/ title="Gardener Cookies" class="dd-item top-level" data-depth=1><a href=/v1.14.0/guides/gardener-cookies/><span class=toggle></span><span class=menu-item-text>Gardener Cookies</span></a></li><li data-nav-id=/v1.14.0/guides/landscape-setup/ title="Landscape Setup" class="dd-item top-level" data-depth=1><a href=/v1.14.0/guides/landscape-setup/><span class=toggle></span><span class=menu-item-text></span>Landscape Setup</span></a></a></li></ul></li></ul></div></nav><a href=# class=menu-toggler><i class="fa fa-angle-double-left"></i></a><script>$(document).ready(function(){$("#sidebar .dd-item:not(.top-level):not(.parent)").hide();$("#sidebar .dd-item.parent").siblings(".dd-item").show();$('.dd-item',"#sidebar .dd-item.parent").show();$(".menu-toggler").click(function(evt){$("#sidebar").toggleClass("collapsed");$(".menu-toggler span").toggleClass("fa-angle-double-left");$(".menu-toggler span").toggleClass("fa-angle-double-right");});})</script><section><div class="highlightable body-inner-wrapper"><div id=body-inner><div class="docs page"><div class=git-wr><div class=page-contributors>Contributors to this page<div class=contributors-list></div></div><div class=page-edit><span class=last-update>Last update:</span><div id=top-github-link><a class=github-link title="Edit this page" href=https://github.com/gardener/documentation/edit/master/website/v1.14.0/guides/client_tools/oidc-login/_index.md target=blank><i class="fa fa-edit"></i><span id=top-github-link-text title="Edit this page"></span></a></div></div></div><h1>Authenticating with an Identity Provider</h1><div class=properties><div class=expertise-level><span class=label title="Expertse level">Expertise</span><svg class="icon level" aria-hidden="true" focusable="false" title="advanced"><use xlink:href="/images/icons/icons.svg#level-3"/></svg></div></div><h1 id=authenticating>Authenticating</h1><p>In this blog you will learn how to:</p><ol><li>Configure an Identity Provider using OpenID Connect.</li><li>Configure a local kubectl plugin to enable <a href=https://github.com/int128/kubelogin>oidc-login</a> .</li><li>Configure the K8s API Server of Gardener managed Kubernetes cluster.</li><li>Create an RBAC rule to authorize an authenticated user.</li></ol><h2 id=motivation>Motivation</h2><p>As a project owner of Gardener, I want my Kubernetes level user to be authenticated by an identity provider.</p><h2 id=prerequisite-knowledge>Prerequisite Knowledge</h2><p>Please read the following background material on <a href=https://kubernetes.io/docs/reference/access-authn-authz/authentication/#openid-connect-tokens>Authenticating</a></p><h2 id=insights-about-gardener>Insights About Gardener</h2><p>The Gardener allows the administrator to modify every aspect of the control plane setup, e.g. all feature gateways and even configurations are programmatically accessible. In this way, every administrative user of the Gardener has full control of how the control plane should be parameterized. But with this power, the user can easily configure a control plane that is beyond any SLA that the Gardener team can arguably support. Therefore, use this power wisely! A configuration that enables experimental features for production becomes an operational responsibility of the cluster owner&rsquo;s team.</p><p>But Gardener does not stop you from experimenting!</p><p>There are currently no default IdP parameters.</p><h2 id=configure-an-identity-provider>Configure an Identity Provider</h2><p>Create a tenant in an OpenID-Connect compatible Identity Provider. For sake of simplicity, we shall use <a href=https://auth0.com/>Auth0</a>, which has a free plan for experimentations.</p><p>In your tenant, setup a native client/application that will use the authentication:
<img src=../../../../__resources/1e540a83-d20a-4dcf-b203-a62d19b09b76.png alt=application>
Configure the client to have a callback url of <code>http://localhost:8000</code>. This callback will connect to your local <code>kubectl oidc-login</code> plugin:
<img src=../../../../__resources/7d720137-189b-4d63-a3bb-4407c5dfedf7.png alt=application></p><p>Note down the following parameters:</p><ul><li>Domain or Issuer url. It <a href=https://openid.net/specs/openid-connect-core-1_0.html#Terminology>must</a> be an <code>https</code>-secured endpoint (In case of Auth0, notice the trailing <code>/</code> at the end).</li><li>Client ID</li><li>Client Secret</li></ul><p>Verify that <code>https://&lt;Issuer>/.well-known/openid-configuration</code> is reachable.</p><p>Now create some users (or connect to a user store):
<img src=../../../../__resources/20c0d68b-39e5-49c8-a9f7-3be75cc584aa.png alt=application>
Notice that the users must have a <em>verified</em> email address. In doubt, just override that setting manually.</p><h2 id=configure-kubectl-oidc-login>Configure kubectl oidc-login</h2><p>Please install the kubectl plugin <a href=https://github.com/int128/kubelogin>oidc-login</a>. We highly recommend the <a href=https://github.com/kubernetes-sigs/krew>krew</a> install tool, which also makes other plugins easily available.</p><div class=highlight><pre class=chroma><code class=language-fallback data-lang=fallback>$ kubectl krew install oidc-login
Updated the local copy of plugin index.
Installing plugin: oidc-login
CAVEATS:
\
 |  You need to setup the OIDC provider, Kubernetes API server, role binding and kubeconfig.
 |  See https://github.com/int128/kubelogin for more.
/
Installed plugin: oidc-login
</code></pre></div><p>Prepare a <code>kubeconfig</code> for later use:</p><div class=highlight><pre class=chroma><code class=language-fallback data-lang=fallback>$ cp ~/.kube/config ~/.kube/config-oidc
</code></pre></div><p>Modify the configurations as follows:</p><div class=highlight><pre class=chroma><code class=language-yaml data-lang=yaml><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>v1</span><span class=w>
</span><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Config</span><span class=w>
</span><span class=w>
</span><span class=w></span><span class=nn>...</span><span class=w>
</span><span class=w>
</span><span class=w></span><span class=nt>contexts</span><span class=p>:</span><span class=w>
</span><span class=w></span>- <span class=nt>context</span><span class=p>:</span><span class=w>
</span><span class=w>    </span><span class=nt>cluster</span><span class=p>:</span><span class=w> </span><span class=l>shoot--project--mycluster</span><span class=w>
</span><span class=w>    </span><span class=nt>user</span><span class=p>:</span><span class=w> </span><span class=l>my-oidc</span><span class=w>
</span><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>shoot--project--mycluster</span><span class=w>
</span><span class=w>
</span><span class=w></span><span class=nn>...</span><span class=w>
</span><span class=w>
</span><span class=w></span><span class=nt>users</span><span class=p>:</span><span class=w>
</span><span class=w></span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>my-oidc</span><span class=w>
</span><span class=w>  </span><span class=nt>user</span><span class=p>:</span><span class=w>
</span><span class=w>    </span><span class=nt>auth-provider</span><span class=p>:</span><span class=w>
</span><span class=w>      </span><span class=nt>config</span><span class=p>:</span><span class=w>
</span><span class=w>        </span><span class=nt>client-id</span><span class=p>:</span><span class=w> </span><span class=l>&lt;Client ID&gt;</span><span class=w>
</span><span class=w>        </span><span class=nt>client-secret</span><span class=p>:</span><span class=w> </span><span class=l>&lt;Client Secret&gt;</span><span class=w>
</span><span class=w>        </span><span class=nt>idp-issuer-url</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;https://&lt;Issuer&gt;/&#34;</span><span class=w>
</span><span class=w>        </span><span class=nt>extra-scopes</span><span class=p>:</span><span class=w> </span><span class=l>email,offline_access,profile</span><span class=w>
</span><span class=w>      </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>oidc</span><span class=w>
</span></code></pre></div><p>Ensure that the modified context is the active context <code>current-context: shoot--project--mycluster</code>.</p><h2 id=configure-the-gardener-shoot-spec>Configure the Gardener Shoot Spec</h2><p>Modify the Gardener shoot/cluster manifest as follows:</p><div class=highlight><pre class=chroma><code class=language-yaml data-lang=yaml><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>core.gardener.cloud/v1beta1</span><span class=w>
</span><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Shoot</span><span class=w>
</span><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>mycluster</span><span class=w>
</span><span class=w>  </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class=l>garden-project</span><span class=w>
</span><span class=w></span><span class=nn>...</span><span class=w>
</span><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span><span class=w>  </span><span class=nt>kubernetes</span><span class=p>:</span><span class=w>
</span><span class=w>    </span><span class=nt>kubeAPIServer</span><span class=p>:</span><span class=w>
</span><span class=w>      </span><span class=nt>oidcConfig</span><span class=p>:</span><span class=w>
</span><span class=w>        </span><span class=nt>clientID</span><span class=p>:</span><span class=w> </span><span class=l>&lt;Client ID&gt;</span><span class=w>
</span><span class=w>        </span><span class=nt>issuerURL</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;https://&lt;Issuer&gt;/&#34;</span><span class=w>
</span><span class=w>        </span><span class=nt>usernameClaim</span><span class=p>:</span><span class=w> </span><span class=l>email</span><span class=w>
</span></code></pre></div><p>This change of the shoot manifest triggers a reconciliation. Once the reconciliation is finished, your oidc configuration is applied. It does <em>not</em> invalidate other certificate based authentication methods. Wait for Gardener to reconcile the change. It can take upto 5min.</p><h2 id=authorize-an-authenticated-user>Authorize an authenticated user</h2><p>For simplicity, we will just authorize a single user with the all encompassing cluster role <code>cluster-admin</code>:</p><div class=highlight><pre class=chroma><code class=language-yaml data-lang=yaml><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>rbac.authorization.k8s.io/v1</span><span class=w>
</span><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>ClusterRoleBinding</span><span class=w>
</span><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>cluster-admin-test</span><span class=w>
</span><span class=w></span><span class=nt>roleRef</span><span class=p>:</span><span class=w>
</span><span class=w>  </span><span class=nt>apiGroup</span><span class=p>:</span><span class=w> </span><span class=l>rbac.authorization.k8s.io</span><span class=w>
</span><span class=w>  </span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>ClusterRole</span><span class=w>
</span><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>cluster-admin</span><span class=w>
</span><span class=w></span><span class=nt>subjects</span><span class=p>:</span><span class=w>
</span><span class=w></span>- <span class=nt>apiGroup</span><span class=p>:</span><span class=w> </span><span class=l>rbac.authorization.k8s.io</span><span class=w>
</span><span class=w>  </span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>User</span><span class=w>
</span><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>test@test.com</span><span class=w>
</span></code></pre></div><p>As administrator, activate/apply the above cluster role binding for <code>test@test.com</code>.</p><h2 id=verify-the-result>Verify the Result</h2><p>Now activate the prepared <code>kubeconfig-oidc</code> and perform a login:</p><div class=highlight><pre class=chroma><code class=language-fallback data-lang=fallback>$ export KUBECONFIG=~/.kube/config-oidc
$ kubectl oidc-login
Open http://localhost:8000 for authentication
</code></pre></div><p>The plugin opens a browser for an interctive authentication session, and in parallel serves a local webserver for the configured callback.</p><p><img src=../../../../__resources/2fd6c631-0dc9-4396-854e-536d570c3d1b.png alt=login></p><p>If you successfully verified your user, then the console will display the validity of your returned token:</p><div class=highlight><pre class=chroma><code class=language-fallback data-lang=fallback>You got a valid token until 2019-08-14 06:26:49 +0200 CEST
</code></pre></div><p>Inspect the <code>kubeconfig-oidc</code>. You will find two additional parameters:</p><div class=highlight><pre class=chroma><code class=language-yaml data-lang=yaml><span class=nn>...</span><span class=w>
</span><span class=w></span><span class=nt>users</span><span class=p>:</span><span class=w>
</span><span class=w></span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>my-oidc</span><span class=w>
</span><span class=w>  </span><span class=nt>user</span><span class=p>:</span><span class=w>
</span><span class=w>    </span><span class=nt>auth-provider</span><span class=p>:</span><span class=w>
</span><span class=w>      </span><span class=nt>config</span><span class=p>:</span><span class=w>
</span><span class=w>        </span><span class=nt>client-id</span><span class=p>:</span><span class=w> </span><span class=l>&lt;Client ID&gt;</span><span class=w>
</span><span class=w>        </span><span class=nt>client-secret</span><span class=p>:</span><span class=w> </span><span class=l>&lt;Client Secret&gt;</span><span class=w>
</span><span class=w>        </span><span class=nt>idp-issuer-url</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;https://&lt;Issuer&gt;/&#34;</span><span class=w>
</span><span class=w>        </span><span class=nt>extra-scopes</span><span class=p>:</span><span class=w> </span><span class=l>email,offline_access,profile</span><span class=w>
</span><span class=w>        </span><span class=nt>id-token</span><span class=p>:</span><span class=w> </span><span class=l>eyJ0eX ... 4In0.QQKS ... TTTw</span><span class=w>
</span><span class=w>        </span><span class=nt>refresh-token</span><span class=p>:</span><span class=w> </span><span class=l>LFt ... 0Skj</span><span class=w>
</span><span class=w>      </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>oidc</span><span class=w>
</span></code></pre></div><p>The plugin persisted the <code>id-token</code> and <code>refresh-token</code> in your configuration file.</p><p>Verify that your user actually has the <code>cluster-admin</code> role:</p><div class=highlight><pre class=chroma><code class=language-fallback data-lang=fallback>$ kubectl get po --all-namespaces
NAMESPACE     NAME                                       READY   STATUS    RESTARTS   AGE
kube-system   blackbox-exporter-954dd954b-tk9vl          1/1     Running   0          7d5h
kube-system   calico-kube-controllers-5f4b46ffb5-ggb7z   1/1     Running   0          7d5h
...

$ kubectl who-can create clusterrolebinding
No subjects found with permissions to create clusterrolebinding assigned through RoleBindings

CLUSTERROLEBINDING                                    SUBJECT                             TYPE            SA-NAMESPACE
cluster-admin                                         system:masters                      Group
cluster-admin-test                                    test@test.com                       User
...
</code></pre></div><p>Congratulations, you have just configured your cluster to authenticate against an Identity Provider using OpenID Connect!</p></div></div></div><div class=howto_tickets><a href=https://github.com/gardener/documentation/issues/new/choose target=_blank><span>Let us know how can we improve.</span>
<span>Open <img src=https://gardener.cloud/images/branding/github-mark-logo-green.svg> GitHub Issue <i class="fa fa-external-link" aria-hidden=true></i></span></a></div></section></div><style></style><footer class=footer><div class="container footer-wrapper"><ul class=nav><li><a href=/blog/>Blogs</a></li><li><a href=/community/>Community</a></li><li><a href=/adopter/>Adopters</a></li><li><a href=/documentation/home>Documentation</a></li></ul><img src=/images/lp/gardener-logo.svg alt="Logo Gardener" class=logo><ul class=media-wr><li><a target=_blank href=https://kubernetes.slack.com/archives/CB57N0BFG><img src=/images/branding/slack-logo-white.svg class=media-icon><div class=media-text>Slack</div></a></li><li><a target=_blank href=https://github.com/gardener><img src=/images/branding/github-mark-logo.png class=media-icon><div class=media-text>GitHub</div></a></li><li><a target=_blank href=https://www.youtube.com/channel/UCwUhwKFREV8Su0gwAJQX7tw><img src=/images/branding/youtube-logo-dark.svg class=media-icon><div class=media-text>YouTube</div></a></li><li><a target=_blank href=https://twitter.com/GardenerProject><img src=/images/branding/twitter-logo-white.svg class=media-icon><div class=media-text>Twitter</div></a></li></ul><span class=copyright>Copyright 2020 Gardener project authors. Privacy Statement</span></div></footer><script src=/js/perfect-scrollbar.min.js?1613639388></script><script src=/js/perfect-scrollbar.jquery.min.js?1613639388></script><script src=/js/jquery.sticky.js?1613639388></script><script src=/js/featherlight.min.js?1613639388></script><script src=/js/html5shiv-printshiv.min.js?1613639388></script><script src=/js/modernizr.custom.71422.js?1613639388></script><link href=/mermaid/mermaid.css?1613639388 type=text/css rel=stylesheet><script src=/mermaid/mermaid.js?1613639388></script><script src=/js/code-snippets.js?1613639388></script><script>mermaid.initialize({startOnLoad:true,htmlLables:true});function createIssue(issueUrl,page,url){var uri=issueUrl+"?title=Documentation issue on page \""+page+"\"";uri=uri+"&body=\n\n<- DESCRIBE MISSING OR FAULTY DOCUMENTATION HERE->\n\n---\nPage: ["+page+"]("+
url+")\ndon't remove the link to the page. It's required for the processor"
var res=encodeURI(uri);res+="&labels=area/documentation"
window.open(res,"issue")
return false;}
$(document).ready(function(){inlineSVG.init();$("[data-publishdate]").each(function(){$(this).text(moment($(this,"YYYY-MM-DD","YYYY-MM-DD hh:mm:ss").attr("data-publishdate")).fromNow());});new ClipboardJS('.clipboard-copy');$("body").codeSnippets();});</script><noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-W2FGNSX" height=0 width=0 style=display:none;visibility:hidden></iframe></noscript></body></html>