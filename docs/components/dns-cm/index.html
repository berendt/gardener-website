
	<!DOCTYPE html>
<html lang="en" class="js csstransforms3d">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

    <meta name="description" content="Documentation for Gardener">
<meta name="author" content="Andreas Herz">

    <link rel="shortcut icon" href="/images/favicon.png" type="image/x-icon" />
<link rel="icon" href="/images/favicon.png" type="image/x-icon" />
    <title>DNS Controller Manager :: Gardener Documentation</title>

    <link rel="icon" type="image/x-icon" href='https://gardener.cloud/images/favicon.ico'>
    <link rel="icon" type="image/png"    href='https://gardener.cloud/images/favicon-32x32.png' sizes="32x32">
    <link rel="icon" type="image/png"    href='https://gardener.cloud/images/favicon-16x16.png' sizes="16x16">

    
    <link href="/css/nucleus.css?1574431610" rel="stylesheet">
    <link href="/css/fontawesome-all.min.css?1574431610" rel="stylesheet">
    <link href="/css/hybrid.css?1574431610" rel="stylesheet">
    <link href="/css/featherlight.min.css?1574431610" rel="stylesheet">
    <link href="/css/perfect-scrollbar.min.css?1574431610" rel="stylesheet">
    <link href="/css/auto-complete.css?1574431610" rel="stylesheet">
    <link href="/css/skeleton.css?1574431610" rel="stylesheet">
    <link href="/css/sheetslider.css?1574431610" rel="stylesheet">

    <script src="/js/moment.js?1574431610"></script>
    <script src="/js/vivus.js?1574431610"></script>
    <script src="/js/scrollreveal.js?1574431610"></script>
    <script src="/js/inlineSVG.js?1574431610"></script>
    <link href="/css/theme.css?1574431610" rel="stylesheet">
    <link href="/css/hugo-theme.css?1574431610" rel="stylesheet">


    
      <link href="/css/theme-gardener.css?1574431610" rel="stylesheet">
    

    <script src="/js/jquery-2.x.min.js?1574431610"></script>
    
    <style type="text/css">
      :root #header + #content > #left > #rlblock_left{ 
          display:none !important;
      }

    </style>

    

  </head>


  <body class="" data-url="/components/dns-cm/">
    <nav id="sidebar" class="">

  <div id="header-wrapper">
    <div id="header">
      <a id="logo" href="https://gardener.cloud/">

	<svg width="90px" height="90px" viewBox="0 0 90 90" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
		
		<title>logo</title>
		<defs>
			<path d="M41.8864954,0.994901575 C42.8830405,0.514990742 44.5028956,0.516982644 45.4953045,0.994901575 L76.8159138,16.0781121 C77.8124589,16.5580229 78.8208647,17.8257185 79.0659694,18.8995926 L86.8015211,52.7912589 C87.0476474,53.8696088 86.6852538,55.4484075 85.9984855,56.3095876 L64.3239514,83.4885938 C63.6343208,84.3533632 62.1740175,85.0543973 61.0725268,85.0543973 L26.3092731,85.0543973 C25.2031915,85.0543973 23.7446167,84.3497739 23.0578485,83.4885938 L1.38331434,56.3095876 C0.693683723,55.4448182 0.335174016,53.865133 0.580278769,52.7912589 L8.31583044,18.8995926 C8.56195675,17.8212428 9.57347722,16.556031 10.5658861,16.0781121 L41.8864954,0.994901575 Z" id="path-1"></path>
			<linearGradient x1="12.7542673%" y1="-18.6617048%" x2="88.2666158%" y2="84.6075483%" id="linearGradient-3">
				<stop stop-color="#FFFFFF" offset="0%"></stop>
				<stop stop-color="#439246" offset="100%"></stop>
			</linearGradient>
			<linearGradient x1="50%" y1="4.93673768%" x2="148.756007%" y2="175.514523%" id="linearGradient-4">
				<stop stop-color="#FFFFFF" offset="0%"></stop>
				<stop stop-color="#439246" offset="100%"></stop>
			</linearGradient>
			<linearGradient x1="19.1574381%" y1="-9.04800713%" x2="82.2203149%" y2="77.9084293%" id="linearGradient-5">
				<stop stop-color="#FFFFFF" offset="0%"></stop>
				<stop stop-color="#439246" offset="100%"></stop>
			</linearGradient>
			<linearGradient x1="57.4403751%" y1="26.3148481%" x2="137.966711%" y2="158.080556%" id="linearGradient-6">
				<stop stop-color="#FFFFFF" offset="0%"></stop>
				<stop stop-color="#439246" offset="100%"></stop>
			</linearGradient>
		</defs>
		<g id="logo" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
			<g id="Rectangle-2" transform="translate(1.000000, 0.000000)">
				<mask id="mask-2" fill="white">
					<use xlink:href="#path-1"></use>
				</mask>
				<use id="Mask" fill="#009F76" xlink:href="#path-1"></use>
				<polygon fill="#000000" opacity="0.289628623" mask="url(#mask-2)" points="-17.6484375 54.5224609 30.8242188 25.0791016 63.4726562 58.5 24.7324219 92.6689453"></polygon>
			</g>
			<path d="M56.8508631,39.260019 C56.4193519,40.443987 55.6088085,41.581593 54.6736295,42.1938694 L46.5997298,47.4799783 C45.2142627,48.3870654 42.9749783,48.3916494 41.5825097,47.4799783 L33.50861,42.1938694 C32.123143,41.2867823 31,39.206345 31,37.545932 L31,26.4150304 C31,25.6897174 31.2131118,24.884885 31.5692681,24.1324532 L56.8508631,39.260019 Z" id="Combined-Shape" fill="url(#linearGradient-3)" transform="translate(43.925432, 36.147233) scale(-1, 1) translate(-43.925432, -36.147233) "></path>
			<path d="M56.0774672,25.1412464 C56.4306829,25.8903325 56.6425556,26.6907345 56.6425556,27.4119019 L56.6425556,38.5428034 C56.6425556,40.2027013 55.5264141,42.2790698 54.1339456,43.1907408 L46.0600459,48.4768498 C44.6745788,49.3839368 42.4352943,49.3885208 41.0428258,48.4768498 L32.9689261,43.1907408 C32.2918101,42.7474223 31.6773514,42.0238435 31.2260376,41.206007 L56.0774672,25.1412464 Z" id="Combined-Shape" fill="url(#linearGradient-4)" transform="translate(43.821278, 37.246598) scale(-1, 1) translate(-43.821278, -37.246598) "></path>
			<path d="M65.0702134,57.1846889 C64.5985426,58.2007851 63.8367404,59.1236871 62.9788591,59.6189851 L47.37497,68.6278947 C45.9443535,69.4538615 43.6226022,69.4525546 42.1942494,68.6278947 L26.5903603,59.6189851 C25.1597438,58.7930183 24,56.7816693 24,55.1323495 L24,37.1145303 C24,36.3487436 24.249712,35.5060005 24.6599102,34.7400631 L65.0702134,57.1846889 Z" id="Combined-Shape" fill="url(#linearGradient-5)"></path>
			<path d="M65.0189476,34.954538 C65.3636909,35.6617313 65.5692194,36.42021 65.5692194,37.1145303 L65.5692194,55.1323495 C65.5692194,56.7842831 64.4072119,58.7943252 62.9788591,59.6189851 L47.37497,68.6278947 C45.9443535,69.4538615 43.6226022,69.4525546 42.1942494,68.6278947 L26.5903603,59.6189851 C25.9237304,59.2341061 25.3159155,58.5918431 24.8568495,57.8487596 L65.0189476,34.954538 Z" id="Combined-Shape" fill="url(#linearGradient-6)"></path>
		</g>
	</svg>
	<h1>Gardener</h1>
	<h2>Universal Kubernetes at Scale</h2>
</a>

    </div>
    <div class="searchbox">
    <label for="search-by"><i class="fas fa-search"></i></label>
    <input data-search-input id="search-by" type="text" placeholder="Search...">
    <span data-search-clear=""><i class="fas fa-close"></i></span>
</div>

<script type="text/javascript" src="/js/lunr.min.js?1574431610"></script>
<script type="text/javascript" src="/js/auto-complete.js?1574431610"></script>
<script type="text/javascript">
    
        var baseurl = '\/';
    
</script>
<script type="text/javascript" src="/js/search.js?1574431610"></script>

  </div>


  <div class="highlightable">
      <ul class="topics">
            
                 
                 




  
    
    <li data-nav-id="/about/" title="Getting Started" class="dd-item
        
        
        
        ">
        
          <a href="/about/">
              
              <img class="navigation-icon" src="https://gardener.cloud/images/navigation_started.svg"/>
              
              Getting Started
          </a>
          
          
      
    </li>
  


            
                 
                 




  
    
    <li data-nav-id="/030-architecture/" title="Architecture" class="dd-item
        parent
        
        
        ">
        
          <a href="/030-architecture/">
              
              <img class="navigation-icon" src="https://gardener.cloud/images/navigation_architecture.svg"/>
              
              Architecture
          </a>
          
          
            <ul>
              
              
                
              
              


              
                
                    




  
    
    <li data-nav-id="/components/gardner/" title="Gardener" class="dd-item
        
        
        
        ">
        
          <a href="/components/gardner/">
              
              Gardener
          </a>
          
          
      
    </li>
  


                
              
                
                    




  
    
    <li data-nav-id="/components/gardenctl/" title="gardenctl" class="dd-item
        
        
        
        ">
        
          <a href="/components/gardenctl/">
              
              gardenctl
          </a>
          
          
      
    </li>
  


                
              
                
                    




  
    
    <li data-nav-id="/components/mcm/" title="Machine Controller Manager" class="dd-item
        
        
        
        ">
        
          <a href="/components/mcm/">
              
              Machine Controller Manager
          </a>
          
          
      
    </li>
  


                
              
                
                    




  
    
    <li data-nav-id="/components/cert--broker/" title="Cert Broker" class="dd-item
        
        
        
        ">
        
          <a href="/components/cert--broker/">
              
              Cert Broker
          </a>
          
          
      
    </li>
  


                
              
                
                    




  
    
    <li data-nav-id="/components/dns-cm/" title="DNS Controller Manager" class="dd-item
        parent
        active
        
        ">
        
          <a href="/components/dns-cm/">
              
              DNS Controller Manager
          </a>
          
          
      
    </li>
  


                
              
                
                    




  
    
    <li data-nav-id="/components/dashboard/" title="Dashboard" class="dd-item
        
        
        
        ">
        
          <a href="/components/dashboard/">
              
              Dashboard
          </a>
          
          
      
    </li>
  


                
              
                
                    




  
    
    <li data-nav-id="/components/kubify/" title="kubify" class="dd-item
        
        
        
        ">
        
          <a href="/components/kubify/">
              
              kubify
          </a>
          
          
      
    </li>
  


                
              
                
                    




  
    
    <li data-nav-id="/components/bouquet/" title="Bouquet" class="dd-item
        
        
        
        ">
        
          <a href="/components/bouquet/">
              
              Bouquet
          </a>
          
          
      
    </li>
  


                
              

            </ul>
        
      
    </li>
  


            
                 
                 




  
    
    <li data-nav-id="/contribute/" title="Contribute" class="dd-item
        
        
        
        ">
        
          <a href="/contribute/">
              
              <img class="navigation-icon" src="https://gardener.cloud/images/navigation_contribute.svg"/>
              
              Contribute
          </a>
          
          
            <ul>
              
              
                
              
              


              
                
                    




  
    
    <li data-nav-id="/contribute/code/" title="Code" class="dd-item
        
        
        
        ">
        
          <a href="/contribute/code/">
              
              Code
          </a>
          
          
            <ul>
              
              
                
              
              


              
                
                    




  
    
    <li data-nav-id="/045_contribute/10_code/10-contribution_guide/" title="Contribution Guide" class="dd-item
        
        
        
        ">
        
          <a href="/045_contribute/10_code/10-contribution_guide/">
              
              Contribution Guide
          </a>
          
          
      
    </li>
  


                
              
                
                    




  
    
    <li data-nav-id="/045_contribute/10_code/12-security_guide/" title="Security Release Process" class="dd-item
        
        
        
        ">
        
          <a href="/045_contribute/10_code/12-security_guide/">
              
              Security Release Process
          </a>
          
          
      
    </li>
  


                
              
                
                    




  
    
    <li data-nav-id="/045_contribute/10_code/13_env/" title="Enviroment" class="dd-item
        
        
        
        ">
        
          <a href="/045_contribute/10_code/13_env/">
              
              Enviroment
          </a>
          
          
      
    </li>
  


                
              
                
                    




  
    
    <li data-nav-id="/045_contribute/10_code/14_cicd/" title="CI/CD" class="dd-item
        
        
        
        ">
        
          <a href="/045_contribute/10_code/14_cicd/">
              
              CI/CD
          </a>
          
          
      
    </li>
  


                
              
                
                    




  
    
    <li data-nav-id="/045_contribute/10_code/15_conf_secrets/" title="Configuration and Usage" class="dd-item
        
        
        
        ">
        
          <a href="/045_contribute/10_code/15_conf_secrets/">
              
              Configuration and Usage
          </a>
          
          
      
    </li>
  


                
              
                
                    




  
    
    <li data-nav-id="/045_contribute/10_code/20_dependencies/" title="Dependencies" class="dd-item
        
        
        
        ">
        
          <a href="/045_contribute/10_code/20_dependencies/">
              
              Dependencies
          </a>
          
          
      
    </li>
  


                
              
                
                    




  
    
    <li data-nav-id="/045_contribute/10_code/27_deploy_into_cluster/" title="Deploy into a Cluster" class="dd-item
        
        
        
        ">
        
          <a href="/045_contribute/10_code/27_deploy_into_cluster/">
              
              Deploy into a Cluster
          </a>
          
          
      
    </li>
  


                
              
                
                    




  
    
    <li data-nav-id="/045_contribute/10_code/30_deploy_seed_into_aks/" title="Deploy into AKS" class="dd-item
        
        
        
        ">
        
          <a href="/045_contribute/10_code/30_deploy_seed_into_aks/">
              
              Deploy into AKS
          </a>
          
          
      
    </li>
  


                
              
                
                    




  
    
    <li data-nav-id="/045_contribute/10_code/37_process/" title="Process" class="dd-item
        
        
        
        ">
        
          <a href="/045_contribute/10_code/37_process/">
              
              Process
          </a>
          
          
      
    </li>
  


                
              
                
                    




  
    
    <li data-nav-id="/045_contribute/10_code/40_repositories/" title="Repositories" class="dd-item
        
        
        
        ">
        
          <a href="/045_contribute/10_code/40_repositories/">
              
              Repositories
          </a>
          
          
      
    </li>
  


                
              

            </ul>
        
      
    </li>
  


                
              
                
                    




  
    
    <li data-nav-id="/contribute/docs/" title="Documentation" class="dd-item
        
        
        
        ">
        
          <a href="/contribute/docs/">
              
              Documentation
          </a>
          
          
            <ul>
              
              
                
              
              


              
                
                    




  
    
    <li data-nav-id="/045_contribute/20_documentation/10_organisation/" title="Organisation" class="dd-item
        
        
        
        ">
        
          <a href="/045_contribute/20_documentation/10_organisation/">
              
              Organisation
          </a>
          
          
      
    </li>
  


                
              
                
                    




  
    
    <li data-nav-id="/045_contribute/20_documentation/20_style/" title="Style Guide" class="dd-item
        
        
        
        ">
        
          <a href="/045_contribute/20_documentation/20_style/">
              
              Style Guide
          </a>
          
          
      
    </li>
  


                
              
                
                    




  
    
    <li data-nav-id="/045_contribute/20_documentation/25_markup/" title="Markdown" class="dd-item
        
        
        
        ">
        
          <a href="/045_contribute/20_documentation/25_markup/">
              
              Markdown
          </a>
          
          
            <ul>
              
              
              


              
                
                    




  
      <li data-nav-id="/045_contribute/20_documentation/25_markup/attachments/" title="Attachments" class="dd-item ">
        <a href="/045_contribute/20_documentation/25_markup/attachments/">
            Attachments
        </a>
    </li>
  


                
              
                
                    




  
      <li data-nav-id="/045_contribute/20_documentation/25_markup/button/" title="Button" class="dd-item ">
        <a href="/045_contribute/20_documentation/25_markup/button/">
            Button
        </a>
    </li>
  


                
              
                
                    




  
      <li data-nav-id="/045_contribute/20_documentation/25_markup/expand/" title="Expand" class="dd-item ">
        <a href="/045_contribute/20_documentation/25_markup/expand/">
            Expand
        </a>
    </li>
  


                
              
                
                    




  
      <li data-nav-id="/045_contribute/20_documentation/25_markup/mermaid/" title="Mermaid" class="dd-item ">
        <a href="/045_contribute/20_documentation/25_markup/mermaid/">
            Mermaid
        </a>
    </li>
  


                
              
                
                    




  
      <li data-nav-id="/045_contribute/20_documentation/25_markup/notice/" title="Notice" class="dd-item ">
        <a href="/045_contribute/20_documentation/25_markup/notice/">
            Notice
        </a>
    </li>
  


                
              

            </ul>
        
      
    </li>
  


                
              

            </ul>
        
      
    </li>
  


                
              

            </ul>
        
      
    </li>
  


            
                 
                 




  
    
    <li data-nav-id="/tutorials/" title="Tutorials" class="dd-item
        
        
        
        ">
        
          <a href="/tutorials/">
              
              <img class="navigation-icon" src="https://gardener.cloud/images/navigation_tutorials.svg"/>
              
              Tutorials
          </a>
          
          
            <ul>
              
              
                
              
              


              
                
                    




  
    
    <li data-nav-id="/using-gardener/administrator/" title="Administrator" class="dd-item
        
        
        
        ">
        
          <a href="/using-gardener/administrator/">
              
              Administrator
          </a>
          
          
      
    </li>
  


                
              
                
                    




  
    
    <li data-nav-id="/using-gardener/developer/topic/" title="App Developer" class="dd-item
        
        
        
        ">
        
          <a href="/using-gardener/developer/topic/">
              
              App Developer
          </a>
          
          
      
    </li>
  


                
              
                
                
              

            </ul>
        
      
    </li>
  


            
                 
                 




  
    
    <li data-nav-id="/curated-links/" title="Curated Links" class="dd-item
        
        
        
        ">
        
          <a href="/curated-links/">
              
              <img class="navigation-icon" src="https://gardener.cloud/images/navigation_links.svg"/>
              
              Curated Links
          </a>
          
          
      
    </li>
  


            
                 
                 




  
    
    <li data-nav-id="/api-reference/" title="API Reference" class="dd-item
        
        
        
        ">
        
          <a href="/api-reference/">
              
              <img class="navigation-icon" src="https://gardener.cloud/images/navigation_tutorials.svg"/>
              
              API Reference
          </a>
          
          
            <ul>
              
              
                
              
              


              
                
                    




  
    
    <li data-nav-id="/api-reference/core/" title="Core" class="dd-item
        
        
        
        ">
        
          <a href="/api-reference/core/">
              
              Core
          </a>
          
          
      
    </li>
  


                
              
                
                    




  
    
    <li data-nav-id="/api-reference/extensions/" title="Extensions" class="dd-item
        
        
        
        ">
        
          <a href="/api-reference/extensions/">
              
              Extensions
          </a>
          
          
      
    </li>
  


                
              
                
                    




  
    
    <li data-nav-id="/api-reference/garden/" title="Garden" class="dd-item
        
        
        
        ">
        
          <a href="/api-reference/garden/">
              
              Garden
          </a>
          
          
      
    </li>
  


                
              
                
                    




  
    
    <li data-nav-id="/api-reference/settings/" title="Settings" class="dd-item
        
        
        
        ">
        
          <a href="/api-reference/settings/">
              
              Settings
          </a>
          
          
      
    </li>
  


                
              

            </ul>
        
      
    </li>
  


            
                 
                 




  
    
    <li data-nav-id="/adopter/" title="" class="dd-item
        
        
        
        ">
        
          <a href="/adopter/">
              
              
          </a>
          
          
      
    </li>
  


            
                 
                 




  
    
    <li data-nav-id="/blog/" title="" class="dd-item
        
        
        
        ">
        
          <a href="/blog/">
              
              
          </a>
          
          
      
    </li>
  


            
                 
                 




  
    
    <li data-nav-id="/community/" title="" class="dd-item
        
        
        
        ">
        
          <a href="/community/">
              
              
          </a>
          
          
      
    </li>
  


            
                 
                 




  
    
    <li data-nav-id="/installer/" title="" class="dd-item
        
        
        
        ">
        
          <a href="/installer/">
              
              
          </a>
          
          
      
    </li>
  


            
      </ul>
      <section id="footer">
        
<script async defer src="https://buttons.github.io/buttons.js"></script>

      </section>

  </div>
</nav>











        <section id="body">
        <div id="overlay"></div>
        <div class="padding highlightable  body-inner-wrapper">

          <div>
              <div id="top-bar">
                
                    <div id="top-github-link">
                        <a class="github-link" title='Edit this page'
                        
                          href='https://github.com/gardener/external-dns-management/edit/master/README.md'
                        
                         target="blank">
                        <i class="fa fa-code-fork"></i>
                          <span id="top-github-link-text">Edit this page</span>
                        </a>
                    </div>
                

                
                <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
                    <span id="sidebar-toggle-span">
                    <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                    <i class="fa fa-bars"></i>
                    </a>
                    </span>
                    
                    <span id="toc-menu"><i class="fa fa-list-alt"></i></span>
                    
                    <span class="links">
                        
            
            
                
                    
                    
            
            
                
                    
                    
            
            
              <a href='/'>Gardener</a> > <a href='/030-architecture/'>Architecture</a> > DNS Controller Manager
            
          
                
            
          
                
            
          
                    </span>
                </div>

                
                <div class="progress">
    <div class="wrapper">
<nav id="TableOfContents">
<ul>
<li><a href="#external-dns-management">External DNS Management</a>
<ul>
<li><a href="#quick-start">Quick start</a></li>
<li><a href="#the-model">The Model</a>
<ul>
<li><a href="#owner-identifiers">Owner Identifiers</a></li>
<li><a href="#dns-classes">DNS Classes</a></li>
</ul></li>
<li><a href="#using-the-dns-controller-manager">Using the DNS controller manager</a></li>
<li><a href="#extensions">Extensions</a>
<ul>
<li><a href="#how-to-implement-source-controllers">How to implement Source Controllers</a></li>
<li><a href="#how-to-implement-provisioning-controllers">How to implement Provisioning Controllers</a>
<ul>
<li><a href="#embedding-a-factory-into-a-controller">Embedding a Factory into a Controller</a></li>
<li><a href="#embedding-a-factory-into-a-compound-factory">Embedding a Factory into a Compound Factory</a></li>
</ul></li>
<li><a href="#setting-up-a-controller-manager">Setting Up a Controller Manager</a></li>
<li><a href="#using-the-standard-compound-provisioning-controller">Using the standard Compound Provisioning Controller</a></li>
<li><a href="#multiple-cluster-support">Multiple Cluster Support</a></li>
</ul></li>
<li><a href="#why-not-using-the-community-external-dns-solution">Why not using the community external-dns solution?</a></li>
</ul></li>
</ul>
</nav>
    </div>
</div>

                
              </div>
          </div>

          
              
              
              
              
              
              
              
              <div id="githubFactsheet">
                <span id="githubLink"><i class="fa fa-github"></i><a target="_blank" href="https://github.com/gardener/external-dns-management/">https://github.com/gardener/external-dns-management/</a></span>
                <a class="github-button" href="https://github.com/gardener" aria-label="Follow @gardener on GitHub">Follow @external-dns-management/</a>
                <a class="github-button" href="https://github.com/gardener/external-dns-management/" data-show-count="true" aria-label="Star gardener/gardener on GitHub">Star</a>
                <div class="tutorial-last-update">Updated <span>


   <span id="87bb8c9ce7802d136b14e1003f3ad10b"></span>
   <script>$("#87bb8c9ce7802d136b14e1003f3ad10b").html(moment("2019-09-13T09:30:35Z").fromNow())</script>


</span> by 


   

   

   

   

   

   

   

   

   

   

   

   

   

   

<a href='mailto:martin.weindel@sap.com'>Martin Weindel</a>, <a href='mailto:i.alidjikov@gmail.com'>Ismail Alidzhikov</a>, <a href='mailto:vlerenc@gmail.com'>Vedran Lerenc</a>, <a href='mailto:uwe.krueger@sap.com'>Uwe Krueger</a>

</div>
              </div>
          

          <div id="body-inner">

          



<br>
<br>




<h1 id="external-dns-management">External DNS Management</h1>

<p>The main artefact of this project is the <b>DNS controller manager</b> for managing DNS records, also
nicknamed as the Gardener &ldquo;DNS Controller&rdquo;.</p>

<p>It contains provisioning controllers for creating DNS records in one of the DNS cloud services
  - <em>Amazon Route53</em>,
  - <em>Google CloudDNS</em>,
  - <em>AliCloud DNS</em>,
   - <em>Azure DNS</em>, or
   - <em>OpenStack Designate</em>,</p>

<p>and source controllers for services and ingresses to create DNS entries by annotations.</p>

<p>The configuration for the external DNS service is specified in a custom resource <code>DNSProvider</code>.
Multiple <code>DNSProvider</code> can be used simultaneously and changed without restarting the DNS controller.</p>

<p>DNS records are either created directly for a corresponding custom resource <code>DNSEntry</code> or by
annotating a service or ingress.</p>

<p>For a detailed explanation of the model, see section <a href="#the-model">The Model</a>.</p>

<p>For extending or adapting this project with your own source or provisioning controllers, see section
<a href="#extensions">Extensions</a></p>

<h2 id="quick-start">Quick start</h2>

<p>To install the <b>DNS controller manager</b> in your Kubernetes cluster, follow these steps.</p>

<ol>
<li><p>Prerequisites</p>

<ul>
<li><p>Check out or download the project to get a copy of the Helm charts.
It is recommended to check out the tag of the
<a href="https://github.com/gardener/external-dns-management/releases">last release</a>, so that Helm
values reference the newest released container image for the deployment.</p></li>

<li><p>Make sure, that you have installed Helm client (<code>helm</code>) locally and Helm server (<code>tiller</code>) on
the Kubernetes cluster. See e.g. <a href="https://helm.sh/docs/install/">Helm installation</a> for more details.</p></li>
</ul></li>

<li><p>Install the DNS controller manager</p>

<p>As multiple Gardener DNS controllers can act on the same DNS Hosted Zone concurrently, each instance needs
an <a href="#owner-identifiers">owner identifier</a>. Therefore choose an identifier sufficiently unique across these instances.</p>

<p>Then install the DNS controller manager with</p>

<pre><code class="language-bash">helm install charts/external-dns-management --name dns-controller --namespace=&lt;my-namespace&gt; --set configuration.identifier=&lt;my-identifier&gt;
</code></pre>

<p>This will use the default configuration with all source and provisioning controllers enabled.
The complete set of configuration variables can be found in <code>charts/external-dns-management/values.yaml</code>.
Their meaning is explained by their corresponding command line options in section
<a href="#using-the-dns-controller-manager">Using the DNS controller manager</a></p>

<p>By default, the DNS controller looks for custom resources in all namespaces. The choosen namespace is
only relevant for the deployment itself.</p></li>

<li><p>Create a <code>DNSProvider</code></p></li>
</ol>

<p>To specify a DNS provider, you need to create a custom resource <code>DNSProvider</code> and a secret containing the
   credentials for your account at the provider. E.g. if you want to use AWS Route53, create a secret and
   provider with</p>

<pre><code class="language-bash">   cat &lt;&lt; EOF | kubectl apply -f -
   apiVersion: v1
   kind: Secret
   metadata:
     name: aws-credentials
     namespace: default
   type: Opaque
   data:
     # replace '...' with values encoded as base64
     # see https://docs.aws.amazon.com/general/latest/gr/managing-aws-access-keys.html
     AWS_ACCESS_KEY_ID: ...
     AWS_SECRET_ACCESS_KEY: ...
   EOF
</code></pre>

<p>and</p>

<pre><code class="language-bash">   cat &lt;&lt; EOF | kubectl apply -f -
   apiVersion: dns.gardener.cloud/v1alpha1
   kind: DNSProvider
   metadata:
     name: aws
     namespace: default
   spec:
     type: aws-route53
     secretRef:
       name: aws-credentials
     domains:
       include:
       # this must be replaced with a (sub)domain of the hosted zone
       - my.own.domain.com
   EOF
</code></pre>

<p>Check the successful creation with</p>

<pre><code class="language-bash">   kubectl get dnspr
</code></pre>

<p>You should see something like</p>

<pre><code>   NAME   TYPE          STATUS   AGE
   aws    aws-route53   Ready    12s
</code></pre>

<ol>
<li>Create a <code>DNSEntry</code></li>
</ol>

<p>Create an DNS entry with</p>

<pre><code class="language-bash">   cat &lt;&lt; EOF | kubectl apply -f -
   apiVersion: dns.gardener.cloud/v1alpha1
   kind: DNSEntry
   metadata:
     name: mydnsentry
     namespace: default
   spec:
     dnsName: &quot;myentry.my-own-domain.com&quot;
     ttl: 600
     targets:
     - 1.2.3.4
   EOF
</code></pre>

<p>Check the status of the DNS entry with</p>

<pre><code>```bash
kubectl get dnsentry
```

You should see something like

```
NAME          DNS                           TYPE          PROVIDER      STATUS    AGE
mydnsentry    myentry.my-own-domain.com     aws-route53   default/aws   Ready     24s
```

As soon as the status of the entry is `Ready`, the provider has accepted the new DNS record.
Depending on the provider and your DNS settings and cache, it may take up to a few minutes before
the domain name can be resolved.
</code></pre>

<ol>
<li>Wait for/check DNS record</li>
</ol>

<p>To check the DNS resolution, use <code>nslookup</code> or <code>dig</code>.</p>

<pre><code class="language-bash">   nslookup myentry.my-own-domain.com
</code></pre>

<p>or with dig</p>

<pre><code class="language-bash">   # or with dig
   dig +short myentry.my-own-domain.com
</code></pre>

<p>Depending on your network settings, you may get a successful response faster using a public DNS server
   (e.g. 8.8.8.8, 8.8.4.4, or 1.1.1.1)</p>

<pre><code class="language-bash">   dig @8.8.8.8 +short myentry.my-own-domain.com
</code></pre>

<p>For more examples about the custom resources and the annotations for services and ingresses
see the <code>examples</code> directory.</p>

<h2 id="the-model">The Model</h2>

<p>This project provides a flexible model allowing to
add DNS source objects and DNS provisioning environments by adding
new independent controllers.</p>

<p>There is no single DNS controller anymore. The decoupling between the
handling of DNS source objects, like ingresses or services, and the
provisioning of DNS entries in an external DNS provider like
<em>Route53</em> or <em>CloudDNS</em> is achieved by introducing a new custom resource
<code>DNSEntry</code>.</p>

<p>These objects can either be explicitly created to request dedicated DNS
entries, or they are managed based on other resources like ingresses or
services. For the latter dedicated <em>DNS Source Controllers</em> are used.
There might be any number of such source controllers. They do not need to know
anything about the various DNS environments. Their task is to figure out which
DNS entries are required in their realm and manage appropriate <code>DNSEntry</code>
objects. From these objects they can also read the provisioning status and
report it back to the original source.</p>

<p><img src="https://github.com/gardener/external-dns-management/blob/master/doc/model.png?raw=true" alt="Model Overview" /></p>

<p>Provisioning of DNS entries in external DNS providers is done by
<em>DNS Provisioning Controllers</em>. They don&rsquo;t need to know anything about the
various DNS source objects. They watch <code>DNSEntry</code> objects and check whether
they are responsible for such an object. If a provisioning controller feels
responsible for an entry it manages the corresponding settings in the
external DNS environment and reports the provisioning status back to the
corresponding <code>DNSEntry</code> object.</p>

<p>To do this a provisioning controller is responsible for a dedicated
environment (for example Route53). For every such environment the controller
uses a dedicated <em>type</em> key. This key is used to look for <code>DNSProvider</code> objects.
There might be multiple such objects per environment, specifying the
credentials needed to access different external accounts. These accounts are then
scanned for DNS zones and domain names they support.
This information is then used to dynamically assign <code>DNSEntry</code> objects to
dedicated <code>DNSProvider</code> objects. If such an assignment can be done by
a provisioning controller then it is <em>responsible</em> for this entry and manages
the corresponding entries in the external environment.
<code>DNSProvider</code> objects can specify explicit inclusion and exclusion sets of domain names
and/or DNS zone identifiers to override the scanning results of the account.</p>

<h3 id="owner-identifiers">Owner Identifiers</h3>

<p>Every DNS Provisioning Controller is responsible for a set of <em>Owner Identifiers</em>.
DNS records in an external DNS environment are attached to such an identifier.
This is used to identify the records in the DNS environment managed by a dedicated
controller (manager). Every controller manager hosting DNS Provisioning Controllers
offers an option to specify a default identifier. Additionally there might
be dedicated <code>DNSOwner</code> objects that enable or disable additional owner ids.</p>

<p>Every <code>DNSEntry</code> object may specify a dedicated owner that is used to tag
the records in the DNS environment. A DNS provisioning controller only acts
of DNS entries it is responsible for. Other resources in the external DNS
environment are not touched at all.</p>

<p>This way it is possbible to
- identify records in the external DNS management environment that are managed
  by the actual controller instance
- distinguish different DNS source environments sharing the same hosted zones
  in the external management environment
- cleanup unused entries, even if the whole resource set is already
  gone
- move the responsibility for dedicated sets of DNS entries among different
  kubernetes clusters or DNS source environments running different
  DNS Provisioning Controller without loosing the entries during the
  migration process.</p>

<p><strong>If multiple DNS controller instances have access to the same DNS zones, it is very important, that every instance uses a unique owner identifier! Otherwise the cleanup of stale DNS record will delete entries created by another instance if they use the same identifier.</strong></p>

<h3 id="dns-classes">DNS Classes</h3>

<p>Multiple sets of controllers of the DNS ecosystem can run in parallel in
a kubernetes cluster working on different object set. They are separated by
using different <em>DNS Classes</em>. Adding a DNS class annotation to an object of the
DNS ecosytems assigns this object to such a dedicated set of DNS controllers.
This way it is possible to maintain clearly separated set of DNS objects in a
single kubernetes cluster.</p>

<h2 id="using-the-dns-controller-manager">Using the DNS controller manager</h2>

<p>The controllers to run can be selected with the <code>--controllers</code> option.
Here the following controller groups can be used:
- <code>dnssources</code>: all DNS Source Controllers. It includes the conrollers
  - <code>ingress-dns</code>: handle DNS annotations for the standard kubernetes ingress resource
  - <code>service-dns</code>: handle DNS annotations for the standard kubernetes service resource</p>

<ul>
<li><p><code>dnscontrollers</code>: all DNS Provisioning Controllers. It includes the controllers</p>

<ul>
<li><code>alicloud-dns</code>:</li>
<li><code>aws-route53</code>:</li>
<li><code>azure-dns</code>:</li>
<li><code>google-clouddns</code>:</li>
<li><code>openstack-designate</code>:
<br /></li>
</ul></li>

<li><p><code>all</code>: (default) all controllers</p></li>
</ul>

<p>It is also possible to list dedicated controllers by their name.</p>

<p>If a DNS Provisioning Controller is enabled it is important to specify a
unique controller identity using the <code>--identifier</code> option.
This identifier is stored in the DNS system to identify the DNS entries
managed by a dedicated controller. There should never be two
DNS controllers with the same identifier running at the same time for the
same DNS domains/accounts.</p>

<p>Here is the complete list of options provided:</p>

<pre><code>Usage:
  dns-controller-manager [flags]

Flags:
      --alicloud-dns.cache-dir string                               Directory to store zone caches (for reload after restart)
      --alicloud-dns.cache-ttl int                                  Time-to-live for provider hosted zone cache
      --alicloud-dns.default.pool.size int                          Worker pool size for pool default of controller alicloud-dns (default: 2)
      --alicloud-dns.disable-zone-state-caching                     disable use of cached dns zone state on changes
      --alicloud-dns.dns-class string                               Identifier used to differentiate responsible controllers for entries
      --alicloud-dns.dns-delay duration                             delay between two dns reconcilations
      --alicloud-dns.dns.pool.resync-period duration                Period for resynchronization of pool dns of controller alicloud-dns (default: 15m0s)
      --alicloud-dns.dns.pool.size int                              Worker pool size for pool dns of controller alicloud-dns (default: 1)
      --alicloud-dns.dry-run                                        just check, don't modify
      --alicloud-dns.identifier string                              Identifier used to mark DNS entries
      --alicloud-dns.ownerids.pool.size int                         Worker pool size for pool ownerids of controller alicloud-dns (default: 1)
      --alicloud-dns.providers.pool.resync-period duration          Period for resynchronization of pool providers of controller alicloud-dns (default: 10m0s)
      --alicloud-dns.providers.pool.size int                        Worker pool size for pool providers of controller alicloud-dns (default: 2)
      --alicloud-dns.reschedule-delay duration                      reschedule delay after losing provider
      --alicloud-dns.secrets.pool.size int                          Worker pool size for pool secrets of controller alicloud-dns (default: 2)
      --alicloud-dns.setup int                                      number of processors for controller setup
      --alicloud-dns.ttl int                                        Default time-to-live for DNS entries
      --aws-route53.cache-dir string                                Directory to store zone caches (for reload after restart)
      --aws-route53.cache-ttl int                                   Time-to-live for provider hosted zone cache
      --aws-route53.default.pool.size int                           Worker pool size for pool default of controller aws-route53 (default: 2)
      --aws-route53.disable-zone-state-caching                      disable use of cached dns zone state on changes
      --aws-route53.dns-class string                                Identifier used to differentiate responsible controllers for entries
      --aws-route53.dns-delay duration                              delay between two dns reconcilations
      --aws-route53.dns.pool.resync-period duration                 Period for resynchronization of pool dns of controller aws-route53 (default: 15m0s)
      --aws-route53.dns.pool.size int                               Worker pool size for pool dns of controller aws-route53 (default: 1)
      --aws-route53.dry-run                                         just check, don't modify
      --aws-route53.identifier string                               Identifier used to mark DNS entries
      --aws-route53.ownerids.pool.size int                          Worker pool size for pool ownerids of controller aws-route53 (default: 1)
      --aws-route53.providers.pool.resync-period duration           Period for resynchronization of pool providers of controller aws-route53 (default: 10m0s)
      --aws-route53.providers.pool.size int                         Worker pool size for pool providers of controller aws-route53 (default: 2)
      --aws-route53.reschedule-delay duration                       reschedule delay after losing provider
      --aws-route53.secrets.pool.size int                           Worker pool size for pool secrets of controller aws-route53 (default: 2)
      --aws-route53.setup int                                       number of processors for controller setup
      --aws-route53.ttl int                                         Default time-to-live for DNS entries
      --azure-dns.cache-dir string                                  Directory to store zone caches (for reload after restart)
      --azure-dns.cache-ttl int                                     Time-to-live for provider hosted zone cache
      --azure-dns.default.pool.size int                             Worker pool size for pool default of controller azure-dns (default: 2)
      --azure-dns.disable-zone-state-caching                        disable use of cached dns zone state on changes
      --azure-dns.dns-class string                                  Identifier used to differentiate responsible controllers for entries
      --azure-dns.dns-delay duration                                delay between two dns reconcilations
      --azure-dns.dns.pool.resync-period duration                   Period for resynchronization of pool dns of controller azure-dns (default: 15m0s)
      --azure-dns.dns.pool.size int                                 Worker pool size for pool dns of controller azure-dns (default: 1)
      --azure-dns.dry-run                                           just check, don't modify
      --azure-dns.identifier string                                 Identifier used to mark DNS entries
      --azure-dns.ownerids.pool.size int                            Worker pool size for pool ownerids of controller azure-dns (default: 1)
      --azure-dns.providers.pool.resync-period duration             Period for resynchronization of pool providers of controller azure-dns (default: 10m0s)
      --azure-dns.providers.pool.size int                           Worker pool size for pool providers of controller azure-dns (default: 2)
      --azure-dns.reschedule-delay duration                         reschedule delay after losing provider
      --azure-dns.secrets.pool.size int                             Worker pool size for pool secrets of controller azure-dns (default: 2)
      --azure-dns.setup int                                         number of processors for controller setup
      --azure-dns.ttl int                                           Default time-to-live for DNS entries
      --cache-dir string                                            default for all controller &quot;cache-dir&quot; options
      --cache-ttl int                                               default for all controller &quot;cache-ttl&quot; options
  -c, --controllers string                                          comma separated list of controllers to start (&lt;name&gt;,source,target,all) (default &quot;all&quot;)
      --cpuprofile string                                           set file for cpu profiling
      --disable-namespace-restriction                               disable access restriction for namespace local access only
      --disable-zone-state-caching                                  default for all controller &quot;disable-zone-state-caching&quot; options
      --dns-class string                                            default for all controller &quot;dns-class&quot; options
      --dns-delay duration                                          default for all controller &quot;dns-delay&quot; options
      --dns-target-class string                                     default for all controller &quot;dns-target-class&quot; options
      --dnsentry-source.default.pool.resync-period duration         Period for resynchronization of pool default of controller dnsentry-source (default: 2m0s)
      --dnsentry-source.default.pool.size int                       Worker pool size for pool default of controller dnsentry-source (default: 2)
      --dnsentry-source.dns-class string                            identifier used to differentiate responsible controllers for entries
      --dnsentry-source.dns-target-class string                     identifier used to differentiate responsible dns controllers for target entries
      --dnsentry-source.exclude-domains stringArray                 excluded domains
      --dnsentry-source.key string                                  selecting key for annotation
      --dnsentry-source.target-creator-label-name string            label name to store the creator for generated DNS entries
      --dnsentry-source.target-creator-label-value string           label value for creator label
      --dnsentry-source.target-name-prefix string                   name prefix in target namespace for cross cluster generation
      --dnsentry-source.target-namespace string                     target namespace for cross cluster generation
      --dnsentry-source.target-owner-id string                      owner id to use for generated DNS entries
      --dnsentry-source.target-realms string                        realm(s) to use for generated DNS entries
      --dnsentry-source.target-set-ignore-owners                    mark generated DNS entries to omit owner based access control
      --dnsentry-source.targets.pool.size int                       Worker pool size for pool targets of controller dnsentry-source (default: 2)
      --dry-run                                                     default for all controller &quot;dry-run&quot; options
      --exclude-domains stringArray                                 default for all controller &quot;exclude-domains&quot; options
      --google-clouddns.cache-dir string                            Directory to store zone caches (for reload after restart)
      --google-clouddns.cache-ttl int                               Time-to-live for provider hosted zone cache
      --google-clouddns.default.pool.size int                       Worker pool size for pool default of controller google-clouddns (default: 2)
      --google-clouddns.disable-zone-state-caching                  disable use of cached dns zone state on changes
      --google-clouddns.dns-class string                            Identifier used to differentiate responsible controllers for entries
      --google-clouddns.dns-delay duration                          delay between two dns reconcilations
      --google-clouddns.dns.pool.resync-period duration             Period for resynchronization of pool dns of controller google-clouddns (default: 15m0s)
      --google-clouddns.dns.pool.size int                           Worker pool size for pool dns of controller google-clouddns (default: 1)
      --google-clouddns.dry-run                                     just check, don't modify
      --google-clouddns.identifier string                           Identifier used to mark DNS entries
      --google-clouddns.ownerids.pool.size int                      Worker pool size for pool ownerids of controller google-clouddns (default: 1)
      --google-clouddns.providers.pool.resync-period duration       Period for resynchronization of pool providers of controller google-clouddns (default: 10m0s)
      --google-clouddns.providers.pool.size int                     Worker pool size for pool providers of controller google-clouddns (default: 2)
      --google-clouddns.reschedule-delay duration                   reschedule delay after losing provider
      --google-clouddns.secrets.pool.size int                       Worker pool size for pool secrets of controller google-clouddns (default: 2)
      --google-clouddns.setup int                                   number of processors for controller setup
      --google-clouddns.ttl int                                     Default time-to-live for DNS entries
      --grace-period duration                                       inactivity grace period for detecting end of cleanup for shutdown
  -h, --help                                                        help for dns-controller-manager
      --identifier string                                           default for all controller &quot;identifier&quot; options
      --ingress-dns.default.pool.resync-period duration             Period for resynchronization of pool default of controller ingress-dns (default: 2m0s)
      --ingress-dns.default.pool.size int                           Worker pool size for pool default of controller ingress-dns (default: 2)
      --ingress-dns.dns-class string                                identifier used to differentiate responsible controllers for entries
      --ingress-dns.dns-target-class string                         identifier used to differentiate responsible dns controllers for target entries
      --ingress-dns.exclude-domains stringArray                     excluded domains
      --ingress-dns.key string                                      selecting key for annotation
      --ingress-dns.target-creator-label-name string                label name to store the creator for generated DNS entries
      --ingress-dns.target-creator-label-value string               label value for creator label
      --ingress-dns.target-name-prefix string                       name prefix in target namespace for cross cluster generation
      --ingress-dns.target-namespace string                         target namespace for cross cluster generation
      --ingress-dns.target-owner-id string                          owner id to use for generated DNS entries
      --ingress-dns.target-realms string                            realm(s) to use for generated DNS entries
      --ingress-dns.target-set-ignore-owners                        mark generated DNS entries to omit owner based access control
      --ingress-dns.targets.pool.size int                           Worker pool size for pool targets of controller ingress-dns (default: 2)
      --key string                                                  default for all controller &quot;key&quot; options
      --kubeconfig string                                           default cluster access
      --kubeconfig.disable-deploy-crds                              disable deployment of required crds for cluster default
      --kubeconfig.id string                                        id for cluster default
  -D, --log-level string                                            logrus log level
      --name string                                                 name used for controller manager
      --namespace string                                            namespace for lease
  -n, --namespace-local-access-only                                 enable access restriction for namespace local access only (deprecated)
      --omit-lease                                                  omit lease for development
      --openstack-designate.cache-dir string                        Directory to store zone caches (for reload after restart)
      --openstack-designate.cache-ttl int                           Time-to-live for provider hosted zone cache
      --openstack-designate.default.pool.size int                   Worker pool size for pool default of controller openstack-designate (default: 2)
      --openstack-designate.disable-zone-state-caching              disable use of cached dns zone state on changes
      --openstack-designate.dns-class string                        Identifier used to differentiate responsible controllers for entries
      --openstack-designate.dns-delay duration                      delay between two dns reconcilations
      --openstack-designate.dns.pool.resync-period duration         Period for resynchronization of pool dns of controller openstack-designate (default: 15m0s)
      --openstack-designate.dns.pool.size int                       Worker pool size for pool dns of controller openstack-designate (default: 1)
      --openstack-designate.dry-run                                 just check, don't modify
      --openstack-designate.identifier string                       Identifier used to mark DNS entries
      --openstack-designate.ownerids.pool.size int                  Worker pool size for pool ownerids of controller openstack-designate (default: 1)
      --openstack-designate.providers.pool.resync-period duration   Period for resynchronization of pool providers of controller openstack-designate (default: 10m0s)
      --openstack-designate.providers.pool.size int                 Worker pool size for pool providers of controller openstack-designate (default: 2)
      --openstack-designate.reschedule-delay duration               reschedule delay after losing provider
      --openstack-designate.secrets.pool.size int                   Worker pool size for pool secrets of controller openstack-designate (default: 2)
      --openstack-designate.setup int                               number of processors for controller setup
      --openstack-designate.ttl int                                 Default time-to-live for DNS entries
      --plugin-dir string                                           directory containing go plugins
      --pool.resync-period duration                                 default for all controller &quot;pool.resync-period&quot; options
      --pool.size int                                               default for all controller &quot;pool.size&quot; options
      --providers string                                            cluster to look for provider objects
      --providers.disable-deploy-crds                               disable deployment of required crds for cluster provider
      --providers.id string                                         id for cluster provider
      --reschedule-delay duration                                   default for all controller &quot;reschedule-delay&quot; options
      --server-port-http int                                        HTTP server port (serving /healthz, /metrics, ...)
      --service-dns.default.pool.resync-period duration             Period for resynchronization of pool default of controller service-dns (default: 2m0s)
      --service-dns.default.pool.size int                           Worker pool size for pool default of controller service-dns (default: 2)
      --service-dns.dns-class string                                identifier used to differentiate responsible controllers for entries
      --service-dns.dns-target-class string                         identifier used to differentiate responsible dns controllers for target entries
      --service-dns.exclude-domains stringArray                     excluded domains
      --service-dns.key string                                      selecting key for annotation
      --service-dns.target-creator-label-name string                label name to store the creator for generated DNS entries
      --service-dns.target-creator-label-value string               label value for creator label
      --service-dns.target-name-prefix string                       name prefix in target namespace for cross cluster generation
      --service-dns.target-namespace string                         target namespace for cross cluster generation
      --service-dns.target-owner-id string                          owner id to use for generated DNS entries
      --service-dns.target-realms string                            realm(s) to use for generated DNS entries
      --service-dns.target-set-ignore-owners                        mark generated DNS entries to omit owner based access control
      --service-dns.targets.pool.size int                           Worker pool size for pool targets of controller service-dns (default: 2)
      --setup int                                                   default for all controller &quot;setup&quot; options
      --target string                                               target cluster for dns requests
      --target-creator-label-name string                            default for all controller &quot;target-creator-label-name&quot; options
      --target-creator-label-value string                           default for all controller &quot;target-creator-label-value&quot; options
      --target-name-prefix string                                   default for all controller &quot;target-name-prefix&quot; options
      --target-namespace string                                     default for all controller &quot;target-namespace&quot; options
      --target-owner-id string                                      default for all controller &quot;target-owner-id&quot; options
      --target-realms string                                        default for all controller &quot;target-realms&quot; options
      --target-set-ignore-owners                                    default for all controller &quot;target-set-ignore-owners&quot; options
      --target.disable-deploy-crds                                  disable deployment of required crds for cluster target
      --target.id string                                            id for cluster target
      --ttl int                                                     default for all controller &quot;ttl&quot; options
</code></pre>

<h2 id="extensions">Extensions</h2>

<p>This project can also be used as library to implement own source and provisioning controllers.</p>

<h3 id="how-to-implement-source-controllers">How to implement Source Controllers</h3>

<p>Based on the provided source controller library a source controller must
implement the <a href="https://github.com/gardener/external-dns-management/blob/master/pkg/dns/source/interface.go"><code>source.DNSSource</code> interface</a> and
provide an appropriate creator function.</p>

<p>A source controller can be implemented following this example:</p>

<pre><code class="language-go">package service

import (
	&quot;github.com/gardener/controller-manager-library/pkg/resources&quot;
	&quot;github.com/gardener/external-dns-management/pkg/dns/source&quot;
)

var _MAIN_RESOURCE = resources.NewGroupKind(&quot;core&quot;, &quot;Service&quot;)

func init() {
	source.DNSSourceController(source.NewDNSSouceTypeForExtractor(&quot;service-dns&quot;, _MAIN_RESOURCE, GetTargets),nil).
		FinalizerDomain(&quot;dns.gardener.cloud&quot;).
		MustRegister(source.CONTROLLER_GROUP_DNS_SOURCES)
}
</code></pre>

<p>Complete examples can be found in the sub packages of <code>pkg/controller/source</code>.</p>

<h3 id="how-to-implement-provisioning-controllers">How to implement Provisioning Controllers</h3>

<p>Provisioning controllers can be implemented based on the provisioning controller library
in this repository and must implement the
<a href="https://github.com/gardener/external-dns-management/blob/master/pkg/dns/provider/interface.go"><code>provider.DNSHandlerFactory</code> interface</a>.
This factory returns implementations of the <a href="https://github.com/gardener/external-dns-management/blob/master/pkg/dns/provider/interface.go"><code>provider.DNSHandler</code> interface</a>
that does the effective work for a dedicated set of hosted zones.</p>

<p>These factories can be embedded into a final controller manager (the runnable
instance) in several ways:</p>

<ul>
<li>The factory can be used to create a dedicated controller.
This controller can then be embedded into a controller manager, either in
its own controller manger or together with other controllers.</li>
<li>The factory can be added to a compound factory, able to handle multiple
infrastructures. This one can then be used to create a dedicated controller,
again.</li>
</ul>

<h4 id="embedding-a-factory-into-a-controller">Embedding a Factory into a Controller</h4>

<p>A provisioning controller can be implemented following this
<a href="https://github.com/gardener/external-dns-management/blob/master/pkg/controller/provider/aws/controller/controller.go">example</a>:</p>

<pre><code class="language-go">package controller

import (
	&quot;github.com/gardener/external-dns-management/pkg/dns/provider&quot;
)

const CONTROLLER_NAME = &quot;route53-dns-controller&quot;

func init() {
	provider.DNSController(CONTROLLER_NAME, &amp;Factory{}).
		FinalizerDomain(&quot;dns.gardener.cloud&quot;).
		MustRegister(provider.CONTROLLER_GROUP_DNS_CONTROLLERS)
}
</code></pre>

<p>This controller can be embedded into a controller manager just by using
an <a href="https://github.com/gardener/external-dns-management/blob/master/cmd/dns/main.go">anonymous import</a> of the controller package in the main package
of a dedicated controller manager.</p>

<p>Complete examples are available in the sub packages of <code>pkg/controller/provider</code>.
They also show a typical set of implementation structures that help
to structure the implementation of such controllers.</p>

<p>The provider implemented in this project always follow the same structure:
- the provider package contains the provider code
- the factory source file registers the factory at a default compound factory
- it contains a sub package <code>controller</code>, which contains the embedding of
  the factory into a dedicated controller</p>

<h4 id="embedding-a-factory-into-a-compound-factory">Embedding a Factory into a Compound Factory</h4>

<p>A provisioning controller based on a <em>Compound Factory</em> can be extended by
a new provider factory by registering this factory at the compound factory.
This could be done, for example,  by using the default compound factory provided
in package <a href="https://github.com/gardener/external-dns-management/blob/master/pkg/controller/provider/compound/factory.go"><code>pkg/controller/provider/compound</code></a> as shown
<a href="https://github.com/gardener/external-dns-management/blob/master/pkg/controller/provider/aws/factory.go">here</a>, where <code>NewHandler</code> is a function creating
a dedicated handler for a dedicated provider type:</p>

<pre><code class="language-go">
package aws

import (
	&quot;github.com/gardener/external-dns-management/pkg/controller/provider/compound&quot;
	&quot;github.com/gardener/external-dns-management/pkg/dns/provider&quot;
)

const TYPE_CODE = &quot;aws-route53&quot;

var Factory = provider.NewDNSHandlerFactory(TYPE_CODE, NewHandler)

func init() {
	compound.MustRegister(Factory)
}
</code></pre>

<p>The compound factory is then again embedded into a provisioning controller as shown
in the previous section (see the <a href="https://github.com/gardener/external-dns-management/blob/master/pkg/controller/provider/compound/controller/controller.go"><code>controller</code>sub package</a>).</p>

<h3 id="setting-up-a-controller-manager">Setting Up a Controller Manager</h3>

<p>One or multiple controller packages can be bundled into a controller manager,
by implementing a main package like <a href="https://github.com/gardener/external-dns-management/blob/master/cmd/dns/main.go">this</a>:</p>

<pre><code class="language-go">package main

import (
	&quot;github.com/gardener/controller-manager-library/pkg/controllermanager&quot;

	_ &quot;github.com/&lt;your controller package&gt;&quot;
	...
)

func main() {
	controllermanager.Start(&quot;my-dns-controller-manager&quot;, &quot;dns controller manager&quot;, &quot;some description&quot;)
}
</code></pre>

<h3 id="using-the-standard-compound-provisioning-controller">Using the standard Compound Provisioning Controller</h3>

<p>If the standard <em>Compound Provisioning Controller</em> should be used it is required
to additionally add the anonymous imports for the providers intended to be
embedded into the compound factory like <a href="https://github.com/gardener/external-dns-management/blob/master/cmd/compound/main.go">this</a>:</p>

<p><details>
<summary><b>Example Coding</b></summary></p>

<pre><code class="language-go">package main

import (
	&quot;fmt&quot;
	&quot;os&quot;

	&quot;github.com/gardener/controller-manager-library/pkg/controllermanager&quot;


	_ &quot;github.com/gardener/external-dns-management/pkg/controller/provider/compound/controller&quot;
	_ &quot;github.com/gardener/external-dns-management/pkg/controller/provider/&lt;your provider&gt;&quot;
	...
)

func main() {
	controllermanager.Start(&quot;dns-controller-manager&quot;, &quot;dns controller manager&quot;, &quot;nothing&quot;)
}
</code></pre>

<p></details></p>

<h3 id="multiple-cluster-support">Multiple Cluster Support</h3>

<p>The controller implementations provided in this project are prepared to work
with multiple clusters by using the features of the used controller manager
library.</p>

<p>The <em>DNS Source Controllers</em> support two clusters:
- the default cluster is used to scan for source objects
- the logical cluster <code>target</code> is used to maintain the <code>DNSEnry</code> objects.</p>

<p>The <em>DNS Provisioning Controllers</em> also support two clusters:
- the default cluster is used to scan for <code>DNSEntry</code> objects. It is mapped
  to the logical cluster <code>target</code>
- the logical cluster <code>provider</code> is used to look to the <code>DNSProvider</code> objects
  and their related secrets.</p>

<p>If those controller types should be combined in a single controller manager,
it can be configured to support three potential clusters with the
source objects, the one for the entry objects and the one with provider
objects using cluster mappings.</p>

<p>This is shown in a complete <a href="https://github.com/gardener/external-dns-management/blob/master/cmd/compound/main.go">example</a> using the dns
source controllers, the compound provisioning controller configured to
support all the included DNS provider type factories:</p>

<p><details>
<summary><b>Example Coding</b></summary></p>

<pre><code class="language-go">package main

import (
	&quot;fmt&quot;
	&quot;os&quot;

	&quot;github.com/gardener/controller-manager-library/pkg/controllermanager&quot;
	&quot;github.com/gardener/controller-manager-library/pkg/controllermanager/cluster&quot;
	&quot;github.com/gardener/controller-manager-library/pkg/controllermanager/controller&quot;
	&quot;github.com/gardener/controller-manager-library/pkg/controllermanager/controller/mappings&quot;

	dnsprovider &quot;github.com/gardener/external-dns-management/pkg/dns/provider&quot;
	dnssource &quot;github.com/gardener/external-dns-management/pkg/dns/source&quot;

	_ &quot;github.com/gardener/external-dns-management/pkg/controller/provider/compound/controller&quot;
	_ &quot;github.com/gardener/external-dns-management/pkg/controller/provider/alicloud&quot;
	_ &quot;github.com/gardener/external-dns-management/pkg/controller/provider/aws&quot;
	_ &quot;github.com/gardener/external-dns-management/pkg/controller/provider/azure&quot;
	_ &quot;github.com/gardener/external-dns-management/pkg/controller/provider/google&quot;
	_ &quot;github.com/gardener/external-dns-management/pkg/controller/provider/openstack&quot;

	_ &quot;github.com/gardener/external-dns-management/pkg/controller/source/ingress&quot;
	_ &quot;github.com/gardener/external-dns-management/pkg/controller/source/service&quot;
)

func init() {
	// target cluster already defined in dns source controller package
	cluster.Configure(
		dnsprovider.PROVIDER_CLUSTER,
		&quot;providers&quot;,
		&quot;cluster to look for provider objects&quot;,
	).Fallback(dnssource.TARGET_CLUSTER)

	mappings.ForControllerGroup(dnsprovider.CONTROLLER_GROUP_DNS_CONTROLLERS).
		Map(controller.CLUSTER_MAIN, dnssource.TARGET_CLUSTER).MustRegister()

}

func main() {
	controllermanager.Start(&quot;dns-controller-manager&quot;, &quot;dns controller manager&quot;, &quot;nothing&quot;)
}
</code></pre>

<p></details></p>

<p>Those clusters can the be separated by registering their names together with
command line option names. These can be used to specify different kubeconfig
files for those clusters.</p>

<p>By default all logical clusters are mapped to the default physical cluster
specified via <code>--kubeconfig</code> or default cluster access.</p>

<p>If multiple physical clusters are defined they can be specified by a
corresponding cluster option defining the kubeconfig file used to access
this cluster. If no such option is specified the default is used.</p>

<p>Therefore, even if the configuration is prepared for multiple clusters,
such a controller manager can easily work on a single cluster if no special
options are given on the command line.</p>

<h2 id="why-not-using-the-community-external-dns-solution">Why not using the community external-dns solution?</h2>

<p>Some of the reasons are context-specific, i.e. relate to Gardener&rsquo;s highly dynamic requirements.</p>

<ol>
<li>Custom resource for DNS entries</li>
</ol>

<p>DNS entries are explicitly specified as custom resources. As an important side effect, each DNS entry provides an own status. Simply by querying the Kubernetes API, a client can check if a requested DNS entry has been successfully added to the DNS backend, or if an update has already been deployed, or if not to reason about the cause. It also opens for easy extensibility, as DNS entries can be created directly via the Kubernetes API. And it simplifies Day 2 operations, e.g. automatic cleanup of unused entries if a DNS provider is deleted.</p>

<ol>
<li>Management of multiple DNS providers</li>
</ol>

<p>The Gardener DNS controller uses a custom resource DNSProvider to dynamically manage the backend DNS services. While with external-dns you have to specify the single provider during startup, in the Gardener DNS controller you can add/update/delete providers during runtime with different credentials and/or backends. This is important for a multi-tenant environment as in Gardener, where users can bring their own accounts.</p>

<p>A DNS provider can also restrict its actions on subset of the DNS domains (includes and excludes) for which the credentials are capable to edit.</p>

<p>Each provider can define a separate “owner” identifier, to differentiate DNS entries in the same DNS zone from different providers.</p>

<ol>
<li>Multi cluster support</li>
</ol>

<p>The Gardener DNS controller distinguish three different logical Kubernetes clusters: Source cluster, target cluster and runtime cluster. The source cluster is monitored by the DNS source controllers for annotations on ingress and service resources. These controllers then create DNS entries in the target cluster. DNS entries in the target cluster are then reconciliated/synchronized with the corresponding DNS backend service by the provider controller. The runtime cluster is the cluster the DNS controller runs on. For example, this enables needed flexibility in the Gardener deployment. The DNS controller runs on the seed cluster. This is also the target cluster. DNS providers and entries resources are created in the corresponding namespace of the shoot control plane, while the source cluster is the shoot cluster itself.</p>

<ol>
<li>Optimizations for handling hundreds of DNS entries</li>
</ol>

<p>Some DNS backend services are restricted on the API calls per second (e.g. the AWS Route 53 API). To manage hundreds of DNS entries it is important to minimize the number of API calls. The Gardener DNS controller heavily makes usage of caches and batch processing for this reason.</p>






        </div> 
        

      </div>


        
        

        
            
            <div class="howto_tickets">
                <span class="open_github_ticket">
                    <h3 class="open_github_ticket_header"><img src="https://gardener.cloud/images/github.svg"/> Report an issue</h3>
                    See a typo? Have a picture to recommend? Want to edit some words/phrases/sentences?
                    You can simply submit a ticket to request we make the change. If you are github savvy, submit a
                    pull request.
                    
                    
                    
                    <a href="#" onclick="return createIssue('https://github.com/gardener/external-dns-management\//issues/new','https:\/\/github.com\/gardener\/external-dns-management.git','https:\/\/github.com\/gardener\/external-dns-management.git')" target="_blank">Open Github Issue <i class="fa fa-external-link" aria-hidden="true"></i></a>
                    <br>
                </span>
            </div>
        


    </section>
    
    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">

      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="/js/clipboard.min.js?1574431610"></script>
    <script src="/js/perfect-scrollbar.min.js?1574431610"></script>
    <script src="/js/perfect-scrollbar.jquery.min.js?1574431610"></script>
    <script src="/js/jquery.sticky.js?1574431610"></script>
    <script src="/js/featherlight.min.js?1574431610"></script>
    <script src="/js/html5shiv-printshiv.min.js?1574431610"></script>
    <script src="/js/highlight.pack.js?1574431610"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="/js/modernizr.custom.71422.js?1574431610"></script>
    <script src="/js/learn.js?1574431610"></script>
    <script src="/js/hugo-learn.js?1574431610"></script>

    <link href="/mermaid/mermaid.css?1574431610" type="text/css" rel="stylesheet" />
    <script src="/mermaid/mermaid.js?1574431610"></script>
    <script>
        mermaid.initialize({ startOnLoad: true, htmlLables: true });
        function createIssue(issueUrl, page, url) {
            var uri = issueUrl+"?title=Documentation issue on page \""+page+"\"";
            uri = uri+ "&body=\n\n<- DESCRIBE MISSING OR FAULTY DOCUMENTATION HERE->\n\n---\nPage: ["+ page +"]("+
            url+ ")\ndon't remove the link to the page. It's required for the processor"
            var res = encodeURI(uri);
            res +="&labels=area/documentation"
            window.open(res,"issue")
            return false;
        }

        $(document).ready(function() {
            var $window = $(window);
            $window.sr = ScrollReveal({ reset: false});
            $window.sr.reveal('.reveal-fast', { duration: 2000 });
            $window.sr.reveal('.reveal-slow', { duration: 2500 });
            $window.sr.reveal('.reveal-right', { duration: 2000, origin:'right', distance:'300px' });
            $window.sr.reveal('.reveal-left', { duration: 2000, origin:'left', distance:'300px' });

            inlineSVG.init();
        });

    </script>
    
    <script>
    
    
    function setMenuHeight() {
        $('#sidebar .highlightable').height($('#sidebar').innerHeight() - $('#header-wrapper').height() - 40);
        $('#sidebar .highlightable').perfectScrollbar('update');
        var $blockList = $('#sidebar .highlightable');
        if ($blockList.length && window.localStorage) {
            var position = localStorage.getItem('blockListScrollPosition');
            if (position) {
                $blockList.scrollTop(position);
            }
            $(window).on('unload', function () {
                var scrollPosition = $blockList.scrollTop();
                localStorage.setItem('blockListScrollPosition', scrollPosition);
            });
        }
    }

    
    
    (function () {
        $("#body-inner a").not(".inline")
            .each(function () {
                if (this.hostname != window.location.hostname && this.href.indexOf("mailto:")===-1) {
                    this.target = '_blank';
                    $(this).addClass("externalLink");
                    if($(this).find("img").length===0) {
                        this.innerHTML += '<i class="fa fa-external-link" aria-hidden="true"></i>';
                    }
                }
            });



    })();

    </script>
  </body>
</html>
